<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    <title>The &quot;New&quot; Encryption of HCA Audio | 花嫁達の部屋</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="中文版本见这里。 Recently CRI Middleware updated their latest ACB archives’ format, and they seemed to have updated encryption of HCA files as well. As a result, the old toolsets can do nothing on the updated">
<meta property="og:type" content="article">
<meta property="og:title" content="The &quot;New&quot; Encryption of HCA Audio">
<meta property="og:url" content="https://blog.mottomo.moe/categories/Tech/RE/en/2018-10-12-New-HCA-Encryption/index.html">
<meta property="og:site_name" content="花嫁達の部屋">
<meta property="og:description" content="中文版本见这里。 Recently CRI Middleware updated their latest ACB archives’ format, and they seemed to have updated encryption of HCA files as well. As a result, the old toolsets can do nothing on the updated">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog.mottomo.moe/images/crack-hca-dragalia/01.jpg">
<meta property="og:image" content="https://blog.mottomo.moe/images/crack-hca-dragalia/02.jpg">
<meta property="og:image" content="https://blog.mottomo.moe/images/crack-hca-dragalia/03.jpg">
<meta property="og:image" content="https://blog.mottomo.moe/images/crack-hca-dragalia/04.jpg">
<meta property="og:image" content="https://blog.mottomo.moe/images/crack-hca-dragalia/05.jpg">
<meta property="og:image" content="https://blog.mottomo.moe/images/crack-hca-dragalia/06.jpg">
<meta property="og:image" content="https://blog.mottomo.moe/images/crack-hca-dragalia/07.jpg">
<meta property="og:image" content="https://blog.mottomo.moe/images/crack-hca-dragalia/08.jpg">
<meta property="og:image" content="https://blog.mottomo.moe/images/crack-hca-dragalia/09.jpg">
<meta property="og:image" content="https://blog.mottomo.moe/images/crack-hca-dragalia/10.jpg">
<meta property="og:image" content="https://blog.mottomo.moe/images/crack-hca-dragalia/11.jpg">
<meta property="article:published_time" content="2018-10-12T19:34:00.000Z">
<meta property="article:modified_time" content="2020-03-30T22:34:35.362Z">
<meta property="article:author" content="头蟹床(Headcrabbed)">
<meta property="article:tag" content="English Version">
<meta property="article:tag" content="Reverse Engineering">
<meta property="article:tag" content="Dragalia Lost">
<meta property="article:tag" content="CGSS">
<meta property="article:tag" content="MLTD">
<meta property="article:tag" content="HCA">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.mottomo.moe/images/crack-hca-dragalia/01.jpg">
    

    

    
        <link rel="icon" href="https://avatars.githubusercontent.com/u/7345875?v=3" />
    

    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/dracula.min.css">
    

    
<link rel="stylesheet" href="/libs/font-awesome5/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/libs/font-awesome5/css/fa-brands.min.css">

    
<link rel="stylesheet" href="/libs/font-awesome5/css/fa-solid.min.css">

    
<link rel="stylesheet" href="/libs/open-sans/styles.css">

    
<link rel="stylesheet" href="/libs/source-code-pro/styles.css">


    
<link rel="stylesheet" href="/css/style.css">


    
<script src="/libs/jquery/2.1.3/jquery.min.js"></script>

    
    
        
<link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">

    
    
        
<link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">

    
    
    
    


<meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">花嫁達の部屋</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/archives">文章存档</a>
                
                    <a class="main-nav-link" href="/categories/Tech/">技术乱炖</a>
                
                    <a class="main-nav-link" href="/categories/ACGN/">二维空间</a>
                
                    <a class="main-nav-link" href="/categories/Misc/Thoughts/">所思所想</a>
                
                    <a class="main-nav-link" href="/tags/English-Version/">English</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="https://avatars.githubusercontent.com/u/7345875?v=3" />
                            <i class="fas fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fas fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/archives">文章存档</a></td>
                
                    <td><a class="main-nav-link" href="/categories/Tech/">技术乱炖</a></td>
                
                    <td><a class="main-nav-link" href="/categories/ACGN/">二维空间</a></td>
                
                    <td><a class="main-nav-link" href="/categories/Misc/Thoughts/">所思所想</a></td>
                
                    <td><a class="main-nav-link" href="/tags/English-Version/">English</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile" class="profile-fixed">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="https://avatars.githubusercontent.com/u/7345875?v=3" />
            <h2 id="name">头蟹床(Headcrabbed)</h2>
            <h3 id="title">THE iDOLM@STER</h3>
            <span id="location"><i class="fas fa-map-marker-alt" style="padding-right: 5px"></i>localhost</span>
            <a id="follow" target="_blank" href="https://github.com/hozuki">喜+1</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                314
                <span>文章</span>
            </div>
            <div class="article-info-block">
                76
                <span>标签</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        
                        <a href="https://github.com/hozuki" target="_blank" title="GitHub" class=tooltip>
                            <i class="fab fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        
                        <a href="mailto:uiharu@buaa.edu.cn" target="_blank" title="Email" class=tooltip>
                            <i class="fa fa-envelope"></i>
                        </a>
                    </td>
                    
                    <td>
                        
                        <a href="/atom.xml" target="_blank" title="RSS Feed" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                    <td>
                        
                        <a href="https://twitter.com/headcrabbed" target="_blank" title="Twitter" class=tooltip>
                            <i class="fab fa-twitter"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
        
	<div class="music-info profile-block">
	  <div class="music-container">
        <a class="music-info-list-url" href="https://music.163.com/#/playlist?id=81647846" target="_blank">Playlist #81647846</a>
		<div>
			<iframe class="music-player" frameborder="no" border="0" marginwidth="0" marginheight="0" height=450 src="https://music.163.com/outchain/player?type=0&id=81647846&auto=0&height=430"></iframe>
		</div>
	  </div>
	</div>
	
    </div>
</aside>

            
            <section id="main"><article id="post-en/2018-10-12-New-HCA-Encryption" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            The &quot;New&quot; Encryption of HCA Audio
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/categories/Tech/RE/en/2018-10-12-New-HCA-Encryption/">
            <time datetime="2018-10-12T19:34:00.000Z" itemprop="datePublished">2018-10-13</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right"></i><a class="article-category-link" href="/categories/Tech/RE/">RE</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/CGSS/" rel="tag">CGSS</a>, <a class="tag-link" href="/tags/Dragalia-Lost/" rel="tag">Dragalia Lost</a>, <a class="tag-link" href="/tags/English-Version/" rel="tag">English Version</a>, <a class="tag-link" href="/tags/HCA/" rel="tag">HCA</a>, <a class="tag-link" href="/tags/MLTD/" rel="tag">MLTD</a>, <a class="tag-link" href="/tags/Reverse-Engineering/" rel="tag">Reverse Engineering</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
                <div id="toc" class="toc-article">
                <strong class="toc-title">Catalogue</strong>
                    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Prelude"><span class="toc-number">1.</span> <span class="toc-text">1. Prelude</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Initial-Analyses"><span class="toc-number">2.</span> <span class="toc-text">2. Initial Analyses</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-File-Analyses"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 File Analyses</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-Next-Directions-of-Investigation"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 Next Directions of Investigation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Initial-Feedback"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 Initial Feedback</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Following-Analyses"><span class="toc-number">3.</span> <span class="toc-text">3. Following Analyses</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-Following-Analyses-of-ACB"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 Following Analyses of ACB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-Other-Simple-Trials"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 Other Simple Trials</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Decompiling"><span class="toc-number">4.</span> <span class="toc-text">4. Decompiling</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-Initial-Analyses-on-Setting-the-Key"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 Initial Analyses on Setting the Key</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-Analyzing-ACB-Generation-and-Reading-Processes"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 Analyzing ACB Generation and Reading Processes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-Analyzing-HCA-Decoding"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 Analyzing HCA Decoding</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-Analyzing-Usages-of-the-Key"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 Analyzing Usages of the Key</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Conclusion"><span class="toc-number">5.</span> <span class="toc-text">5. Conclusion</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-The-Future-of-HCA-Extraction-and-Decoding"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 The Future of HCA Extraction and Decoding</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-Some-Comments"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 Some Comments</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-The-Gain"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 The Gain?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-Thank-List"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 Thank List</span></a></li></ol></li></ol>
                </div>
            
            <p>中文版本见<a href="/categories/Tech/RE/zh/2018-10-12-New-HCA-Encryption/">这里</a>。</p>
<p>Recently CRI Middleware updated their latest ACB archives’ format, and they seemed to have updated encryption of HCA files as well. As a result, the old toolsets can do nothing on the updated files. After about 20 hours of research I finally found what they changed on the decryption. Might be the first in the world, again. This is what’s called “highlight moment” in reverse engineering. XD</p>
<p>The final answer is somewhat simple: transform the decryption key, and use the transformed key to initialize the decryption table. The formula is <code>key&#39; = key * ((uint64_t)(k2 &lt;&lt; 16) | (uint16_t)(~k2 + 2))</code> where <code>key</code> is the input key and <code>k2</code> is a secondary key stored in the higher 16 bits of “field alignment” field, in each ACB/AWB file.</p>
<p>This article is about the way and thoughts of finding this transformation. It is roughly recorded in time order. I hope these materials may help someone in the future.</p>
<p>My result is based on various people’s works. Without thoses pieces, the whole puzzle cannot be completed. So a big thank you for everyone involved.</p>
<p><span style="color: red;"><strong>Be noted again: the contents in this article must not be used for commercial purposes.</strong></span></p>
<a id="more"></a>
<hr>
<p>* “Decode” in the text below may mean decode after decrypting when applicable.</p>
<p>* Sorry about the broken tenses in the last paragraphs. I was too tired to fix them all.</p>
<h1 id="1-Prelude"><a href="#1-Prelude" class="headerlink" title="1. Prelude"></a>1. Prelude</h1><p>As the new game Dragalia Lost (ドラガリアロスト) is released, CRI Middleware revealed their updated audio technology. As for me, a guy who does not play games in the “normal” way, I care about resource extraction more than how it displays in the game. Forward thinking is what I should do as a game developer, and reversed thinking is for the cracker identity (not “cracker” as in “cookie” :P).</p>
<p>This update updates ACB version from 1.29 to 1.30. Although it is a minor upgrade, it brings a trouble that, HCAs cannot be decrypted even with the correct key. It began with an <a href="https://github.com/hozuki/libcgss/issues/4" target="_blank" rel="noopener">issue</a> created by FZFalzar. When I received the email, I didn’t know or understood what was going on. In the next day, esterTion posted a screenshot of a comment in his <a href="https://estertion.win/2018/09/dragalialost%E9%80%9F%E8%A7%88/" target="_blank" rel="noopener">blog article</a>, saying that someone is not able to decode extracted HCA with the game provided. I recalled that the key is the one I saw in that issue, so this must not be a coincidence. Together with the information FZFalzar provided, the new tools should have changed something, which might break backward compatibility. I could imagine if the same measure is applied on CGSS or MLTD, or other games, maybe, a doom for audio extraction. So I decided to challenge it.</p>
<h1 id="2-Initial-Analyses"><a href="#2-Initial-Analyses" class="headerlink" title="2. Initial Analyses"></a>2. Initial Analyses</h1><h2 id="2-1-File-Analyses"><a href="#2-1-File-Analyses" class="headerlink" title="2.1 File Analyses"></a>2.1 File Analyses</h2><p>The first thing to do is analyzing the files to see whether there are some “odd” values.</p>
<p>Since I already had an ACB extraction tool (<code>AcbUnzip</code>), I directly dragged the attached ACB on it. Unexpectedly, <code>AcbUnzip</code> crashed, only throwing an exception and creating an empty file. I also tried VGMToolbox, which created 6 files, but all of the files were empty too.</p>
<p>Since I wrote <code>AcbUnzip</code>, I could debug it. I found that the difference of the number of files is caused by the difference of the numbers of cues and tracks. There was only one cue, but there were 6 tracks (3 in internal AWB and 3 in external AWB). But the bigger problem was that, though I had the information of file entries, I could not extract them. The file sizes were negative numbers with extremely large absolute values! After narrowing down by instrumentation, I saw that the value of “field alignment” fields in AFS2 (the file structure used by AWB) was quite strange. According to VGMToolbox, it should be a 32-bit unsigned integer. From the past experience, the value is usually 32. However this time, it was far larger than the file size.</p>
<p>The most common guess should be there is a mask. So I looked at the value in hex digits. The lower 16 bits were <code>0x0020</code>, which is 32; the higher 16 bits were something unknown. Obviously, it is masked by <code>0x0000ffff</code>. I successfully extracted all HCA files after doing this.</p>
<p>The exception was the first piece of the puzzle. Besides applying a mask, it also exposed the fact that the layout of AWB had changed. As I said, since the field offset (32-bit unsigned integer) was usually 32, which is far smaller than 65535 (<code>0xffff</code>), its higher 16 bits were actually reserved. Here I began to doubt if CRI did use the higher bits as reserved and attached some other meanings to them. But I still could not determine whether they were random numbers (to disturb analysis) or they do have a meaning.</p>
<p>After the HCAs were extracted, it was time to take a view on them. They looked normal: no unknown header parts or blocks, no out-of-range values, and no additional information added. The only recognizable thing was the size of HCA header extended from 96 (CGSS/MLTD) to 397. But except for known fields, the header was filled with zeros.</p>
<p>Here I made 3 assumptions:</p>
<ol>
<li>The actual size of the HCA header can affect the decoding choices of the decoder. You can think it as a hidden version information apart from the “version” field in the HCA header.</li>
<li><code>comp1</code> to <code>comp10</code> (referring to the HCA decoder) were set to some meaning values that affect the decoding process. I did not know what those fields mean so I was unable to proof or deduce only by observing.</li>
<li>Nothing was changed. The file was still a traditional HCA.</li>
</ol>
<p>All these assumptions were possible, requiring more materials to proof or falsify.</p>
<p>At this point, the limit of file analyses was reached.</p>
<h2 id="2-2-Next-Directions-of-Investigation"><a href="#2-2-Next-Directions-of-Investigation" class="headerlink" title="2.2 Next Directions of Investigation"></a>2.2 Next Directions of Investigation</h2><p>Just as I replied in the issue, after some observations, considering the updating speed of the technology, iteration cost (time and finance), I thought of 4 most possible possibilities:</p>
<ol>
<li>The decoding process was changed.</li>
<li>New branches were introduced in the decoding process.</li>
<li>Precomputed tables were changed.</li>
<li>Real decryption key was different from the input key.</li>
</ol>
<p>Of course their combinations were also possible in reality. Here let me explain the details of each possibility.</p>
<p><em>The first possibility.</em> The new decoder employed an entire new theory. This means huge changes in theory and code, which can be seen as a new audio format. CRI should not have enough time and financial support to do this.</p>
<p><em>The second possibility.</em> Think about the values of <code>comp1</code> to <code>comp10</code> mentioned above. Considering known code structure of the public decoder, if new branches were introduced to handle values that never appeared before (in the context of code, <code>if</code>), then new branches or new tables would be logical. I thought it possible, but proving is hard. It depends on the decompiled code.</p>
<p><em>The third possibility.</em> Since the core of decoding is value mapping using the precomputed tables, could the tables themselves were modified (the code should also be updated) so that input were mapped to different outputs? This thought also depends on decompilation.</p>
<p><em>The fourth possibility.</em> This is a two-phase encryption. The overall process was untouched but the key was transformed internally, or a decryption table different than the previous one was generated using the same key. Obviously this is the most probable way. All you need to do is adding a few lines of code, and all the public decoders stop working. The cost is close to zero. Combining with the decoding workflow of HCA, in validation, decryption and decoding, a process does not influence the previous one(s). So the key can be easily set to a new one. (By the way, this is also how <code>hcacc</code> <a href="https://github.com/hozuki/libcgss/blob/master/docs/behind-the-scenes.md" target="_blank" rel="noopener">works</a>.)</p>
<p>However my guess was that the key was modified before initializing the decryption table. For that I was wrong.</p>
<h2 id="2-3-Initial-Feedback"><a href="#2-3-Initial-Feedback" class="headerlink" title="2.3 Initial Feedback"></a>2.3 Initial Feedback</h2><p>Because I could only obtain a lite version of the SDK (ADX2LE SDK), which does not support encryption and decryption, and FZFalzar had the full SDK (ADX2 SDK), I asked him to start with some tests. While those tests are in progress, I began the initial reverse engineering on tools in ADX2LE SDK.</p>
<p>I had a question above: is the new SDK backward-compatible? It can play the latest ACB, but can it play old ones? Whatever the answer is, it would help eliminate false guesses. My personal guess was the new SDK is not backward-compatible, but the test results disagreed. According to the fact I believed that there was not an all-new <del>all-different</del> decoder and tables were unlikely to change. The greatest change would be adding branches and tables, at most. If we got lucky, it would be much easier.</p>
<h1 id="3-Following-Analyses"><a href="#3-Following-Analyses" class="headerlink" title="3. Following Analyses"></a>3. Following Analyses</h1><h2 id="3-1-Following-Analyses-of-ACB"><a href="#3-1-Following-Analyses-of-ACB" class="headerlink" title="3.1 Following Analyses of ACB"></a>3.1 Following Analyses of ACB</h2><p>FZFalzar found out that the SDK cannot play extracted HCAs (not being packed inside ACB/AWB) with correct keys. He thought maybe the something got into the metadata of ACB. So I checked the new structure of ACB using <a href="https://github.com/hcs64/vgm_ripping/tree/master/multi/utf_tab" target="_blank" rel="noopener"><code>utf_tab</code></a>. The first apparent change was the update of format version. CGSS uses version 1.23.1, MLTD uses 1.29.0, while this one was in 1.30.0.</p>
<p>From my experience learned from MLTD’s ACB upgrade (compared to CGSS), upgrading usually means adding new tables. Current ACB format can only use a limited number of fields (for easy coding?), so it reserved several slots in the end. CGSS (1.23.1) had 18 reserved slots (R0 to R17), and in MLTD (1.29.0) there were only 12 (R0 to R11). And this time (1.30.0), a new table <code>SoundGeneratorTable</code> was added compared to MLTD. Could this table influence HCA decoding? I thought not. In the sample ACB, the size of this table was zero. If this table is used as a switch, CRI could have chosen a much simpler type. If it is a table and it does have influence, it should not be empty, but filled with some meaningful data.</p>
<p>I did not find other important differences in this sample ACB besides this new table. Some control tables, such as <code>TrackCommandTable</code>, <code>SynthCommandTable</code> and <code>TrackEventTable</code> is not yet parsed, they should not play such row because of their usages in history. To be sure, I modified some values and tested, with no luck.</p>
<p>At this time, FZFalzer sent the player (Atom Viewer, 2.25.14) in the latest full SDK. Finally I was able to test the keys.</p>
<p>During testing, I discovered something interesting. I mentioned before that in the header of AWB there were 16 unknown bits (2 bytes) in “field alignment” field. This time I tried to modify those two “garbage” bytes. I tested these combinations with the new player:</p>
<ol>
<li>ACB from CGSS (internal AWB), with no modification. (These 2 bytes were always <code>00 00</code> in previous ACBs.)</li>
<li>ACB from CGSS, with modification.</li>
<li>ACB from Dragalia Lost (external AWB), with no modification.</li>
<li>ACB from Dragalia Lost, modified internal “garbage” bytes only.</li>
<li>ACB from Dragalia Lost, modified external “garbage” bytes only.</li>
<li>ACB from Dragalia Lost, modified internal and external “garbage” bytes.</li>
<li>ACB from Dragalia Lost (internal AWB), with no modification.</li>
<li>ACB from Dragalia Lost, modified “garbage” bytes.</li>
</ol>
<p>If the AWB is an external one, the information in ACB will declare that the AWB is a streaming one. Inside ACB it will also store a copy of the header of the AWB. So I thought it was necessary to test both internal and external modifications.</p>
<p>Guess which ones could be played normally? The answer is 1, 3, 4, 5, 6 and 7. Yes, all combinations from 3 to 6 could be played. This was a bit strange but it might be a mistake during test. Now that the decryption is already retrieved, there is no need to test them again. But you can still try it if you like.</p>
<p>The results showed that even ACBs in old versions could not be played with those two bytes modified. So these two bytes must be playing some kind of roles. But where the switch is and how are the bytes involved, were still unknown.</p>
<p>Later FZFalzer tested 2017 version of the SDK (possibly the one MLTD uses) and reported that it could not play the new ACBs. Therefore, the breaking change exists between these two versions.</p>
<h2 id="3-2-Other-Simple-Trials"><a href="#3-2-Other-Simple-Trials" class="headerlink" title="3.2 Other Simple Trials"></a>3.2 Other Simple Trials</h2><p>Considering that there were 6 HCAs in the ACB, and they were in two groups, members in which were of the similar size. Could they be XORed? I tested this possibility but the answer was no.</p>
<p>What about between groups? Like simple cyclical passwords with short key and long encrypted text? Nope.</p>
<p>How about direct key manipulation? Assuming that those two bytes are used, but none of adding, substracting, shifting or masking worked.</p>
<h1 id="4-Decompiling"><a href="#4-Decompiling" class="headerlink" title="4. Decompiling"></a>4. Decompiling</h1><p>All other methods were run out. I had to use the last resort, decompling. Decompling can almost solve all problems, but also with very high costs. It requires massive time, energy, techniques and experience. I was not sure if I can solve the problem before I reach my limit.</p>
<p>The materials i had were ADX2LE SDK (mainly Win/X86) and the APK from Dragalia Lost (Android/ARM32). Later the new player (Win/X86-64) was also used.</p>
<h2 id="4-1-Initial-Analyses-on-Setting-the-Key"><a href="#4-1-Initial-Analyses-on-Setting-the-Key" class="headerlink" title="4.1 Initial Analyses on Setting the Key"></a>4.1 Initial Analyses on Setting the Key</h2><p>This step began at the same time when I asked FZFalzar to do the compatibility tests. My intention was looking at the usages of the key after it is set. The entry point was quite obvious, the well-known <code>criWareUnity_SetDecryptionKey()</code>.</p>
<p><img src="/images/crack-hca-dragalia/01.jpg" alt="Decryption setting in Dragalia Lost, level 1"></p>
<p>Statically trace to the location above. The first thing we can see is that the input key is not changed during this process. Another noticable point is, the input key, or the original key, has passed the file verification. Now follow the decryption setting of Atom (audio decoding component) to the next level.</p>
<p><img src="/images/crack-hca-dragalia/02.jpg" alt="Decryption setting in Dragalia Lost, level 2"></p>
<p>Here we run into some troubles. There are lots of global variables and unknown arrays or class members. But by looking carefully you can see that the key is only printed out (to the debug output) here, with some data whose meanings are unknown. If you know a little about the C language, you may have noticed that the call to <code>sub_CEF9C()</code> is problematic. According to its arguments, it should be something like <code>printf_s()</code>, or at least a function with variable arguments. But in the assembly code it is still like this in the picture. The problem is we don’t know what that function outputted. Statical tracing shows the original value of the key is assigned to <code>dword_17AC90</code>, which was not used in the decompiled code. In assembly code, it is set to a register (then its value is assigned to a class member) but not pushed into the stack. Well I can’t get anything more from this, because I don’t know too much about ARM stuff. This lead ends here.</p>
<h2 id="4-2-Analyzing-ACB-Generation-and-Reading-Processes"><a href="#4-2-Analyzing-ACB-Generation-and-Reading-Processes" class="headerlink" title="4.2 Analyzing ACB Generation and Reading Processes"></a>4.2 Analyzing ACB Generation and Reading Processes</h2><p>FZFalzar mentioned the library <code>CpkMaker.dll</code> in the SDK. He said in the new versions the alignment is set to a large value, while it is 32 unless manually assigned in the old SDKs. Let’s take a look.</p>
<p>Although I don’t have the full SDK, but LE is sufficient for making an impression of code structure. <code>CpkMaker.dll</code> is a .NET assembly, which is out of my estimation. It is written in C++/CLI, apparently. So what are the other libraries that are easy to decompile? From previous exprience I already knew <code>AudioStream.dll</code> is an assembly. From its UI, Atom Craft is obviously a Windows Forms application. With these as an entry point, I found <code>CriAtomGears.dll</code> and <code>AcCore.dll</code>. <code>AtomPreview.dll</code> (who exports some APIs similar to the runtimes of CRI products) and <code>AtomPreviewer_PC.exe</code> are native PE binaries. Managed code for encoding/decoding, or packing/unpacking are not found in these assemblies, so they are definitely inside those native binaries.</p>
<p>Atom Craft has two playback modes. If you import an audio file (which they call “material”) and play it in the Materials panel, it is the audio file itself that is played. But, if you add the audio file into one of the cues, open Session window (in menu View - Session Window), drag the cue onto the list in Session window, and then click the play button, Atom Craft will generate and ACB (content encoding is specified  in project settings) and play the ACB file. This difference means behind the different playback handling, there is a invocation from managed code to native code; whether it is P/Invoke or C++/CLI is yet to be tested.</p>
<p>Therefore I try to find the click event. The window name itself is a hint. After painful searches I found it. (I have to say, the code sucks, and assemblies are not well divided.) But the mechanism is not so direct as I think. It uses a C/S architecture. Sending (commands) and receiving (events) are all based on messages. The messaging seems to be wired through sockets. So at run time, Atom Craft starts a native server, and the calls are actually RPCs. As for encoding and packing, it references <code>AudioStream.dll</code> and <code>CpkMaker.dll</code>, inside which the functions are completed using P/Invoke. I have to decompile <code>AtomPreview.dll</code> and <code>AtomPreviewer_PC.exe</code>.</p>
<p>The immediate choice is <code>AtomPreview.dll</code>, because it exposes some APIs. This time, I enter the library from code for ACB to look at the reading process. Well, this is much harder than reading decryption settings. I can only perform three levels of static analysis and the analysis is heavily interfered by class members, so I cannot find something interesting. It is not easy to be dynamically analyzed (can attach to the process though). The code structure is far different from expected and the key signature <code>@UTF</code> is not found anywhere so I don’t know where to start.</p>
<p>Analyzing this from the shared library in Draglia Lost’s APK is as difficult as above.</p>
<p>Atom Viewer in ADX2LE SDK can play the bundle files too. But it does not have public APIs. In the issue comments FZFalzar said the related code is “baked” into the library (in fact this is called static linking :P). Even it does not expose public APIs, there is still a way to locate the code, just make good use of its logs. According to the log, search for string <code>Open ACB:</code> and follow the references. In the end you will find a function with characteristics very similar to <code>criAtomExAcb_LoadAcbFile()</code>. However it is still hard to analyze.</p>
<h2 id="4-3-Analyzing-HCA-Decoding"><a href="#4-3-Analyzing-HCA-Decoding" class="headerlink" title="4.3 Analyzing HCA Decoding"></a>4.3 Analyzing HCA Decoding</h2><p>Compared to the key settings and ACB, HCA-related functions look harder to catch because they are not exposed anywhere. In addition, the decoding process runs in a background thread, so there is no way to find a direct entry (like from <code>criAtomExPlayer_Start</code>).</p>
<p>Now what? Scan for tiny traces they leak to the surface. Reading the public decoder code, the most impressive thing is those precomputed tables. These tables will lead us to the hidden functions. As a commercial decoder, speed is another important consideration, apart from precision. Sometimes you will have to balance between them. The official decoder is also likely to choose a trading-space-for-time strategy, and it would be even better if they use the same tables. Anyway, try our luck first.</p>
<p>Based on the public HCA decoder, the decoding framework is like:</p>
<pre><code class="lang-cpp">void decode_block(Block *block) {
    validate_block(block);
    decrypt_block(block);

    for each channel { decode1(channel); }    
    for (i = 0..7) {
        for each channel { decode2(channel); }
        for each channel { decode3(channel); }
        for each channel { decode4(channel); }
        for each channel { decode5(channel); }
    }

    to_wave(channels);
}
</code></pre>
<p>Just have a first expectation in mind. Now let’s see if the official decoder use the same tables.</p>
<p>Here we choose the first element in the second table inside <code>decode5()</code>, <code>0xBD0A8B04</code>. The reason to choose <code>decode5()</code> is, it lies on the last location in the innermost loop. Its feature serves well as a beacon. As for which table, that is a casual choice. In the worst case just try them all. During searching beware the endianess. Here I use the Atom Viewer from the full SDK (because I prefer X86/X86-64 to ARM), so the search pattern is <code>D4 8B 0A BD</code>.</p>
<p><img src="/images/crack-hca-dragalia/03.jpg" alt="Search result for 0xBD0A8BD4 (Hex Editor)"></p>
<p><img src="/images/crack-hca-dragalia/04.jpg" alt="Search result for 0xBD0A8BD4 (IDA)"></p>
<p>As expected, it is found in the global variable segment. Having a glance at its previous and next elements, it is obvious that this is the table we are interested in. Now switch from Hex View to IDA view and do a xref (cross referencing). Results show that this address is only referenced by one function, whose address is <code>0x00007FF606770718</code>. Do some more searches on the tables used in this function, we can also find the first table in <code>decode5()</code>. This means the function we are looking is probably <code>decode5()</code> or at least a part of it. The caller of this function contains the third table, and another part of <code>decode5()</code>.</p>
<p><img src="/images/crack-hca-dragalia/05.jpg" alt="decode5()"></p>
<p>Repeating the same operations, find all referenced known tables until the top level of known region is reached. Here is a function <code>decode_block()</code>. In this process you may find multiple references to the same function. Just try them one by one.</p>
<p><img src="/images/crack-hca-dragalia/06.jpg" alt="decode_block()"></p>
<p>Don’t mind the mild differences of code structure between this and the framework above. The interesting thing is their key characteristics. Keep in mind that compiler optimization is quite powerful.</p>
<p>Again, go up until the top level is reached and there is no obvious caller. Now you should reach a function at <code>0x00007FF6067688F4</code>. xref-ing shows it becomes a function pointer, which means dynamic invocation, for example registering in a function table or as callback. Inside this function we can find a string literal <code>Failed to decode HCA header.</code>, next to which is a function reading the HCA header (located at <code>0x00007FF60676A274</code>; I name it <code>FindAndLoadHcaHeader</code> because it include some code to search for the offset of the header). Reading the HCA header and audio data block decoding appear inside the same function. What is the function like? Yep, a common (and bad) pattern:</p>
<pre><code class="lang-cpp">if (flag == PARSE_HCA_HEADER) {
    FindAndLoadHcaHeader(pData);
    DecodeAudioBlock(pData + headerSize); // Immediately reads the first audio block after reading the HCA header
} else if (flag == DECODE_AUDIO_BLOCK) {
    DecodeAudioBlock(pData);
}
</code></pre>
<p>Now put that aside. Maybe you will question about the disparity between <code>decode_block()</code> and the public decoding framework. Now let’s check what the code is like in tools in an old version SDK (ADX2LE). Using the same technique to locate the corresponding <code>decode_block()</code> inside <code>AtomPreviewer_PC.exe</code>. It seems the general structures are alike. Forget not, that we are not comparing the decompiled code and the public code, but between old and new versions of the SDK. As there is no (obvious) difference, the decoding procedure should not have changed, and neither should the tables.</p>
<p>Now there is only one question left. What are the meanings of <code>comp1</code> to <code>comp10</code> (<code>comp9</code> and <code>comp10</code> are calculated using the other <code>comp</code> values)? How do they affect encoding and decoding? Can they take “strange” values? At this time, I suddenly found <a href="https://github.com/Thealexbarney/VGAudio" target="_blank" rel="noopener">VGAudio</a>. It was like hitting by a lightning when I read its readme. The shocking fact (to me) is that, the repository includes the principles and details of HCA encoding. There is even an HCA encoder! From this repository I know that those values have fixed meanings, which cannot be, “strange”.</p>
<p>So only one of the four possibilities in the beginning still stands. All of other “hard” (not easily changed) functionalities are unchanged. The key is the only thing modified. But this is contradict to what I discovered above, so there should be something I missed.</p>
<h2 id="4-4-Analyzing-Usages-of-the-Key"><a href="#4-4-Analyzing-Usages-of-the-Key" class="headerlink" title="4.4 Analyzing Usages of the Key"></a>4.4 Analyzing Usages of the Key</h2><p>Finally, the finale. This time let’s trace the <code>criWarePC_SetDecryptionKey()</code> (well, the name is a guess) inside Atom Viewer.</p>
<p>But… isn’t this function not exported? How can we find it? Fear not. We use the same technique as locating from log. The place in <code>criWareUnity_SetDecryptionKey()</code>, where I stuck before, has a variable argument function that could not be understood. There is a format string in that function: <code>%s, %lld, %lld, %s, 0x%08X, 0x%08X, %d</code>, hard-coded. This means in Atom Viewer, there should also be the same, hard-coded string. Open Strings View and search for it. Next step, searching for references.</p>
<p><img src="/images/crack-hca-dragalia/07.jpg" alt="Referenced locations"></p>
<p>Considering that C/C++ compilers will merge the same strings, it is normal to see such a number of results. A little patience is all we need. Luckily, the first result brings us to the correct location.</p>
<p><img src="/images/crack-hca-dragalia/08.jpg" alt="Isn&#39;t it familiar?"></p>
<p>The picture above is what it is like after I annotated. But before annotation the high similarity between it and the previous function we analyzed.</p>
<p>Here is a tip. The Hex-Rays Decompiler (F5 in IDA) is not very good a processing variable argument functions. You have to enter that function and exit, to see its correct arguments. (This does not work on ARM. I don’t know why.) After a simple static tracing of one level, most of the symbol names can be deduced. If you are familiar with HCA encryption and decryption, you can pick out <code>InitDecrypter()</code> quickly. Some information requires dynamic debugging, for example finding strings in tables.</p>
<p>Enter <code>InitDecrypter()</code>. A little tracing will show the initialization of type-0, type-1 and type-56 encryptions. The value it returns, according to the log, is “DecrypterHn”, which looks like “decryptor handle”. But if you read it more carefully, you will know that this value is a pointer to the decryption table. This pointer is used by two global variables (one at <code>0x00007FF606818CC8</code>, another one at <code>0x00007FF606819628</code>). But neither of these two reveals a meaningful result for tracing.</p>
<p><img src="/images/crack-hca-dragalia/09.jpg" alt="Inside InitDecrypter()"></p>
<p>As we can see, after the normal initialization of this decryption table, it is used as the decryption table for both HCA and HCA-MX. You can confirm the usage name from doing one more xref. So here is where the decoding code analyses and decryption code analyses converge.</p>
<p>I did a simple dynamic debugging. Until setting the decryption tables for HCA and HCA-MX, the contents of the table is still the same as computed using public tools. So there is nothing abnormal until here. But what I am looking for is <em>all</em> references of the key and the decryption table, so I am able to notice this assignment:</p>
<pre><code class="lang-cpp">v8 = sub_7FF606712670();
*v8 = keyLit2;
</code></pre>
<p>Obviously, the key is passed to somewhere else, in addition to the normal usages we see before. Why should this redundant move be introduced?</p>
<p>Expand <code>sub_7FF606712670()</code> and you can see that all it does is returning the address of a global variable:</p>
<pre><code class="lang-cpp">void *sub_7FF606712670() {
  return &amp;unk_7FF606821B30;
}
</code></pre>
<p>Where is <code>unk_7FF606821B30</code> used? Static analysis tells us it is only referenced inside this function. But <code>sub_7FF606712670()</code>, is used at two locations.</p>
<p><img src="/images/crack-hca-dragalia/10.jpg" alt="References to sub_7FF606712670()"></p>
<p>After checking these references, jackpot.</p>
<p><img src="/images/crack-hca-dragalia/11.jpg" alt="Second encryption"></p>
<p>Tracing the pointer <code>v4</code>, which received the pointer to the key, it’s easy to find that it is used in another round of computation, and<code>v6</code> should be the new key. As expected, the function which uses <code>v6</code> is for generating a type-56 decryption table. (So why bother writing the same function two times? I don’t understand what CRI guys think.) The problem is how does <code>v5</code> come from. I add a breakpoint at the assignment of <code>v6</code>, open an ACB, but the breakpoint is not hit. Well, this is an ACB from CGSS. When using an ACB from Dragalia Lost, I get a hit. The value of <code>v5</code> is <code>0x80b2</code>, a familar number. I immediately recognized that, this is the two “garbage” bytes inside the ACB/AWB. Although <code>v5</code> comes from the call result of <code>sub_7FF6066F28C0()</code>, which is the value of a class member, but it is obvious that this <em>is</em> those two bytes. Observing the referencing status of <code>sub_7FF6067006CC()</code>, which is strongly related ACB reading, the inference has a high probability to be a right one.</p>
<p>So I did a little modification to the existing HCA decoder and put in the transformation. And yes, the decoding was successful. Another test on the ACB inside Dragalia Lost’s APK was also successful. Now we can conclude that the reverse engineering this time completed in success.</p>
<p>Let’s read the formula again: <code>key&#39; = key * ((uint64_t)(k2 &lt;&lt; 16) | (uint16_t)(~k2 + 2))</code>. <code>key</code> is the input key, and <code>k2</code> is a 16-bit integer stored in every AWB. Mind the signed/unsigned and length truncation. Also, it does not throw exceptions when the muplication overflows.</p>
<p>If <code>k2 == 0</code>, the key is not transformed. See the decision on <code>v5</code>. For example, esterTion found out Princess Connect Re:Dive also uses ACB 1.30, but the HCAs extracted is still able to be handled by existing tools. This is because the bytes at field alignment is <code>20 00 00 00</code>.</p>
<h1 id="5-Conclusion"><a href="#5-Conclusion" class="headerlink" title="5. Conclusion"></a>5. Conclusion</h1><h2 id="5-1-The-Future-of-HCA-Extraction-and-Decoding"><a href="#5-1-The-Future-of-HCA-Extraction-and-Decoding" class="headerlink" title="5.1 The Future of HCA Extraction and Decoding"></a>5.1 The Future of HCA Extraction and Decoding</h2><p>After this update, HCA can use de facto dynamic keys. Directly decoding HCA files using the static keys will not be safe anymore. Batch decoding HCAs are not possible, but it is still doable when having ACB/AWB. It’s just adding another shell. All the tools are still public, and all you need to do is writing a small fix. LOL.</p>
<p>* Update on Oct 16: The vgmstream guys (whose members also watched the issue) already pushed the changes on Oct 14. Wow.</p>
<h2 id="5-2-Some-Comments"><a href="#5-2-Some-Comments" class="headerlink" title="5.2 Some Comments"></a>5.2 Some Comments</h2><p>Well you don’t have to read this in the English version. Just my personal comments.</p>
<h2 id="5-3-The-Gain"><a href="#5-3-The-Gain" class="headerlink" title="5.3 The Gain?"></a>5.3 The Gain?</h2><p>To be short, the flexible use of data for attacks. For detailed explanations please read the Chinese version.</p>
<h2 id="5-4-Thank-List"><a href="#5-4-Thank-List" class="headerlink" title="5.4 Thank List"></a>5.4 Thank List</h2><p>Written in the order I think of, when I write this section.</p>
<ul>
<li><a href="https://github.com/FZFalzar" target="_blank" rel="noopener">FZFalzar</a> raising the problem, some experiments, and supplying Atom Viewer</li>
<li><a href="https://github.com/Thealexbarney" target="_blank" rel="noopener">Alex Barney</a> and his amazing <a href="https://github.com/Thealexbarney/VGAudio" target="_blank" rel="noopener">VGAudio</a></li>
<li><a href="https://sourceforge.net/projects/vgmtoolbox/" target="_blank" rel="noopener">VGMToolbox</a> from <a href="https://sourceforge.net/u/snakemeat/profile/" target="_blank" rel="noopener">snakemeat</a></li>
<li>The anonymous guy who provided the HCA decoder code (ancient code published on 2ch before 2014)</li>
<li><a href="https://github.com/hozuki/libcgss/issues/4" target="_blank" rel="noopener">Everyone discussed in the issue</a></li>
<li>And me (:D) (←You already participated in the discussion!</li>
</ul>

        
        </div>
        <footer class="article-footer">
            
                <div class="copyright">
    <table>
        <tbody>
        <tr>
            <td class="copyright-entry">作者：</td><td class="copyright-value"><a href="https://blog.mottomo.moe">头蟹床(Headcrabbed)</a></td>
        </tr>
        <tr>
            <td class="copyright-entry">标题：</td><td class="copyright-value">The &quot;New&quot; Encryption of HCA Audio</td>
        </tr>
        <tr>
            <td class="copyright-entry">URL：</td><td class="copyright-value"><a href="/categories/Tech/RE/en/2018-10-12-New-HCA-Encryption/">https://blog.mottomo.moe/categories/Tech/RE/en/2018-10-12-New-HCA-Encryption/</a></td>
        </tr>
        </tbody>
    </table>
    <p class="copyright-reprint-rule">
        如果您觉得这篇文章对您有帮助，欢迎按照下面的许可进行转载。转载请注明来源。<br/>If you find this article helpful, you are welcome to reprint it following the license below, with source credited.
    </p>
    <p class="copyright-reprint-rule">
        
    </p>
    <p class="copyright-cc">
      <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/" target="_blank"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/3.0/cn/88x31.png" /></a>
      <span class="copyright-cc-text">&nbsp;本作品采用
      <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/" target="_blank">知识共享署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a>
      进行许可。<br/>&nbsp;This work is licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.en" target="_blank">CC BY-NC-SA 3.0 CN License</a>.</span>
    </p>
</div>

                <div class="donate">
    <table class="donate-desc">
        <tbody>
        <tr>
            <td>如果您觉得这篇文章对您很有帮助，不妨捐助一下。</td>
        </tr>
        <tr>
            <td>If you find this article really helpful, you can buy me a coffee. :P</td>
        </tr>
        </tbody>
    </table>
    <table class="donate-method">
        <tbody>
        <tr>
            <td>PayPal</td>
            <td><a href="https://paypal.me/headcrabbed" target="_blank" rel="noopener">https://paypal.me/headcrabbed</a></td>
        </tr>
        </tbody>
    </table>
</div>

            
            <div class="share-container">



</div>

    <a data-url="https://blog.mottomo.moe/categories/Tech/RE/en/2018-10-12-New-HCA-Encryption/" data-id="ck8f3bcpu0000vgi81vlq3mqd" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="https://blog.mottomo.moe/categories/Tech/RE/en/2018-10-12-New-HCA-Encryption/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="https://blog.mottomo.moe/categories/Tech/RE/en/2018-10-12-New-HCA-Encryption/">Comments</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/categories/ACGN/zh/2018-11-12-Romantic-Tragedy-in-Tiger-and-Bunny/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    老虎和兔子中的一段浪漫悲剧
                
            </div>
        </a>
    
    
        <a href="/categories/Tech/RE/zh/2018-10-12-New-HCA-Encryption/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">HCA 的“新式”加密</div>
        </a>
    
</nav>


    
</article>


    
    
        <section id="comments">
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus</a>.</noscript>
    </div>
</section>
    

</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <!--<ul id="recent-post" class="">-->
                <ul id="recent-post">
                
                    <li class="no-thumbnail">
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Tech/">Tech</a></p>
                            <p class="item-title"><a href="/categories/Tech/zh/2023-04-09-GitHub-SSH-Key-Error/" class="title">简单记录一下 GitHub SSH 主机密钥失效的问题解决</a></p>
                            <p class="item-date"><time datetime="2023-04-09T10:37:00.000Z" itemprop="datePublished">2023-04-09</time></p>
                        </div>
                    </li>
                
                    <li class="no-thumbnail">
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right"></i><a class="article-category-link" href="/categories/Tech/Coding/">Coding</a></p>
                            <p class="item-title"><a href="/categories/Tech/Coding/zh/2023-04-09-Unity-Input-System-Control-Scheme/" class="title">Unity Input System 的控制方案（control scheme）应该怎么用？</a></p>
                            <p class="item-date"><time datetime="2023-04-09T06:26:00.000Z" itemprop="datePublished">2023-04-09</time></p>
                        </div>
                    </li>
                
                    <li class="no-thumbnail">
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Misc/">Misc</a></p>
                            <p class="item-title"><a href="/categories/Misc/zh/2022-04-20-Lenovo-Y540-Keyboard-Stopped-Working/" class="title">关于联想Y540键盘停止工作的事</a></p>
                            <p class="item-date"><time datetime="2022-04-19T23:23:00.000Z" itemprop="datePublished">2022-04-20</time></p>
                        </div>
                    </li>
                
                    <li class="no-thumbnail">
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right"></i><a class="article-category-link" href="/categories/Tech/Coding/">Coding</a></p>
                            <p class="item-title"><a href="/categories/Tech/Coding/en/2020-07-26-CSharp-Tuple-Element-Names-and-Method-Signatures/" class="title">C# Tuple Element Names and Method Signatures</a></p>
                            <p class="item-date"><time datetime="2020-07-26T11:42:00.000Z" itemprop="datePublished">2020-07-26</time></p>
                        </div>
                    </li>
                
                    <li class="no-thumbnail">
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right"></i><a class="article-category-link" href="/categories/Tech/Coding/">Coding</a></p>
                            <p class="item-title"><a href="/categories/Tech/Coding/zh/2020-07-26-CSharp-Tuple-Element-Names-and-Method-Signatures/" class="title">C# 元组元素名称和方法签名相关</a></p>
                            <p class="item-date"><time datetime="2020-07-26T11:42:00.000Z" itemprop="datePublished">2020-07-26</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ACGN/">ACGN</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Misc/">Misc</a><span class="category-list-count">180</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Misc/Fun/">Fun</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Misc/Records/">Records</a><span class="category-list-count">80</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Misc/Thoughts/">Thoughts</a><span class="category-list-count">9</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/">Tech</a><span class="category-list-count">119</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/ACGN/">ACGN</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/Coding/">Coding</a><span class="category-list-count">59</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/RE/">RE</a><span class="category-list-count">16</span></li></ul></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/NET/" style="font-size: 10px;">.NET</a> <a href="/tags/3D/" style="font-size: 14.17px;">3D</a> <a href="/tags/Alternative-Girls/" style="font-size: 10px;">Alternative Girls</a> <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/Boost/" style="font-size: 10px;">Boost</a> <a href="/tags/Bulletproof/" style="font-size: 18.33px;">Bulletproof</a> <a href="/tags/CGSS/" style="font-size: 15.83px;">CGSS</a> <a href="/tags/CPlusPlus/" style="font-size: 13.33px;">CPlusPlus</a> <a href="/tags/CSharp/" style="font-size: 11.67px;">CSharp</a> <a href="/tags/DereTore/" style="font-size: 15.83px;">DereTore</a> <a href="/tags/DirectX/" style="font-size: 10.83px;">DirectX</a> <a href="/tags/Dragalia-Lost/" style="font-size: 10.83px;">Dragalia Lost</a> <a href="/tags/English-Version/" style="font-size: 11.67px;">English Version</a> <a href="/tags/FFmpeg/" style="font-size: 11.67px;">FFmpeg</a> <a href="/tags/FGBT-Bangumi-Assistant/" style="font-size: 10px;">FGBT-Bangumi Assistant</a> <a href="/tags/Foobar2000/" style="font-size: 10px;">Foobar2000</a> <a href="/tags/GC/" style="font-size: 10.83px;">GC</a> <a href="/tags/GF-%E2%99%AA/" style="font-size: 10px;">GF(♪)</a> <a href="/tags/GLantern/" style="font-size: 14.17px;">GLantern</a> <a href="/tags/Gal-Game/" style="font-size: 10px;">Gal Game</a> <a href="/tags/Game-Off-2017/" style="font-size: 10px;">Game Off 2017</a> <a href="/tags/HCA/" style="font-size: 12.5px;">HCA</a> <a href="/tags/Hexo/" style="font-size: 10.83px;">Hexo</a> <a href="/tags/JSON/" style="font-size: 10px;">JSON</a> <a href="/tags/Java/" style="font-size: 10.83px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/KeiSystem/" style="font-size: 11.67px;">KeiSystem</a> <a href="/tags/MCI/" style="font-size: 10px;">MCI</a> <a href="/tags/MLTD/" style="font-size: 15.83px;">MLTD</a> <a href="/tags/MSIL/" style="font-size: 10px;">MSIL</a> <a href="/tags/MonoGame/" style="font-size: 10.83px;">MonoGame</a> <a href="/tags/NW-js/" style="font-size: 10px;">NW.js</a> <a href="/tags/Numba/" style="font-size: 10px;">Numba</a> <a href="/tags/OI/" style="font-size: 10px;">OI</a> <a href="/tags/OpenAL/" style="font-size: 10px;">OpenAL</a> <a href="/tags/Paiza/" style="font-size: 10px;">Paiza</a> <a href="/tags/Postfix/" style="font-size: 10px;">Postfix</a> <a href="/tags/PulseAudio/" style="font-size: 10px;">PulseAudio</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/Reverse-Engineering/" style="font-size: 10.83px;">Reverse Engineering</a> <a href="/tags/SDL2/" style="font-size: 10.83px;">SDL2</a> <a href="/tags/SQLite/" style="font-size: 10px;">SQLite</a> <a href="/tags/SharpDX/" style="font-size: 11.67px;">SharpDX</a> <a href="/tags/TypeScript/" style="font-size: 10px;">TypeScript</a> <a href="/tags/Unity/" style="font-size: 10px;">Unity</a> <a href="/tags/Unity3D/" style="font-size: 10.83px;">Unity3D</a> <a href="/tags/Visual-Basic/" style="font-size: 10.83px;">Visual Basic</a> <a href="/tags/Visual-Studio/" style="font-size: 10.83px;">Visual Studio</a> <a href="/tags/WSL/" style="font-size: 10px;">WSL</a> <a href="/tags/WebGL/" style="font-size: 12.5px;">WebGL</a> <a href="/tags/Windows-8/" style="font-size: 10px;">Windows 8</a> <a href="/tags/kawashima/" style="font-size: 10px;">kawashima</a> <a href="/tags/live/" style="font-size: 10px;">live</a> <a href="/tags/%E4%B8%8D%E5%8F%AA%E6%98%AF%E6%8A%80%E6%9C%AF/" style="font-size: 10px;">不只是技术</a> <a href="/tags/%E4%B8%AA%E4%BA%BA/" style="font-size: 10px;">个人</a> <a href="/tags/%E4%BB%A3%E7%A0%81/" style="font-size: 11.67px;">代码</a> <a href="/tags/%E5%8A%A8%E6%BC%AB/" style="font-size: 11.67px;">动漫</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 10px;">博客</a> <a href="/tags/%E5%8D%9A%E5%AE%A2%E5%9B%AD%E8%AE%B0%E5%BD%95/" style="font-size: 13.33px;">博客园记录</a> <a href="/tags/%E5%8F%91%E5%B8%83/" style="font-size: 15px;">发布</a> <a href="/tags/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" style="font-size: 10.83px;">垃圾回收</a> <a href="/tags/%E5%B0%8F%E5%93%81/" style="font-size: 11.67px;">小品</a> <a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 10px;">并发</a> <a href="/tags/%E5%BC%B9%E5%B9%95/" style="font-size: 17.5px;">弹幕</a> <a href="/tags/%E5%BF%83%E8%B7%B3%E6%96%87%E5%AD%A6%E9%83%A8/" style="font-size: 10px;">心跳文学部</a> <a href="/tags/%E6%89%8B%E6%B8%B8/" style="font-size: 10.83px;">手游</a> <a href="/tags/%E6%97%A5%E5%B8%B8/" style="font-size: 20px;">日常</a> <a href="/tags/%E6%9C%AA%E6%9D%A5%E8%8A%B1%E5%9B%AD%E5%9B%9E%E5%BF%86/" style="font-size: 17.5px;">未来花园回忆</a> <a href="/tags/%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0/" style="font-size: 10px;">析构函数</a> <a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 10.83px;">架构</a> <a href="/tags/%E6%B8%B8%E6%88%8F/" style="font-size: 10px;">游戏</a> <a href="/tags/%E6%B8%B8%E6%88%8F%E6%9D%82%E8%B0%88/" style="font-size: 10px;">游戏杂谈</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%BD%91%E7%AB%99%E7%BB%B4%E6%8A%A4/" style="font-size: 10px;">网站维护</a> <a href="/tags/%E8%BF%87%E5%8E%BB%E7%9A%84%E4%BA%BA%E4%BA%8B%E7%89%A9/" style="font-size: 19.17px;">过去的人事物</a> <a href="/tags/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/" style="font-size: 16.67px;">逆向工程</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">世界那么大</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://aicdg.com/" target="_blank" rel="noopener">一切胡里花哨的技术(自称)</a>
                    </li>
                
                    <li>
                        <a href="http://kkrainbow.github.io/" target="_blank" rel="noopener">KKRainbow</a>
                    </li>
                
                    <li>
                        <a href="https://kanoha.org/" target="_blank" rel="noopener">jabbany</a>
                    </li>
                
                    <li>
                        <a href="http://tsundere.moe/" target="_blank" rel="noopener">Frederick888</a>
                    </li>
                
                    <li>
                        <a href="http://blog.higan.me/" target="_blank" rel="noopener">HiganKanshi</a>
                    </li>
                
                    <li>
                        <a href="https://blog.kagami.moe/" target="_blank" rel="noopener">少年读书隙中窥月</a>
                    </li>
                
                    <li>
                        <a href="https://estertion.win/" target="_blank" rel="noopener">esterTion</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
        
    <div class="widget-wrap">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">32</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">February 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09/">September 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/11/">November 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07/">July 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/02/">February 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/01/">January 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/12/">December 2010</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/10/">October 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/08/">August 2010</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/07/">July 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/06/">June 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
    <div id="toTop" class="fas fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2023 头蟹床(Headcrabbed)<br/>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, hosted with ❤ by <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a><br/>
            Theme by <a href="http://github.com/ppoffice" target="_blank" rel="noopener">Ruipeng Zhang</a>, updated by <a href="https://github.com/hozuki/" target="_blank" rel="noopener">Hozuki</a>
        </div>
    </div>
</footer>


<!-- Highlight.js -->
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

<script src="/js/hljs-exec.js"></script>




<script src="/js/black-curtain.js"></script>


        
    
    <script>
    var disqus_config = function () {
        
            this.page.url = 'https://blog.mottomo.moe/categories/Tech/RE/en/2018-10-12-New-HCA-Encryption/';
        
        this.page.identifier = 'en/2018-10-12-New-HCA-Encryption';
    };
    (function() { 
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'uiharumoe' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        s.addEventListener("error", function () {
            var div = d.getElementById("disqus_thread");
            
            var s = d.createElement("span");
            s.textContent = "Unable to load Disqus comments. Please check your DNS settings and whether it is blocked by GFW.";
            
            while (div.firstChild) {
                div.removeChild(div.firstChild);
            }
            
            div.appendChild(s);
        });
        (d.head || d.body).appendChild(s);
    })();
</script>




    
        
<script src="/libs/lightgallery/js/lightgallery.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-pager.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-zoom.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-hash.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-share.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-video.min.js"></script>

    
    
        
<script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>

    
    
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
        </script>
        
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML.js"></script>

    



<!-- Custom Scripts -->

<script src="/js/main.js"></script>


    </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>