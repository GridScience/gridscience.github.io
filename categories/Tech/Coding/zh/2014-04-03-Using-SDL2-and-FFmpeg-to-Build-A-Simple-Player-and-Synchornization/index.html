<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    <title>博客园第一篇——SDL2+FFmpeg 制作简单播放器与同步 | 花嫁達の部屋</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="博客园地址 原标题：博客园第一篇——SDL2+FFmpeg 制作简单播放器&amp;同步，因为“&amp;”字符无法被百度sitemap插件处理写入 XML，所以改动了标题。">
<meta property="og:type" content="article">
<meta property="og:title" content="博客园第一篇——SDL2+FFmpeg 制作简单播放器与同步">
<meta property="og:url" content="https://blog.mottomo.moe/categories/Tech/Coding/zh/2014-04-03-Using-SDL2-and-FFmpeg-to-Build-A-Simple-Player-and-Synchornization/index.html">
<meta property="og:site_name" content="花嫁達の部屋">
<meta property="og:description" content="博客园地址 原标题：博客园第一篇——SDL2+FFmpeg 制作简单播放器&amp;同步，因为“&amp;”字符无法被百度sitemap插件处理写入 XML，所以改动了标题。">
<meta property="og:locale" content="zh">
<meta property="article:published_time" content="2014-04-03T14:54:00.000Z">
<meta property="article:modified_time" content="2020-03-30T22:34:35.388Z">
<meta property="article:author" content="头蟹床(Headcrabbed)">
<meta property="article:tag" content="博客园记录">
<meta property="article:tag" content="SDL2">
<meta property="article:tag" content="FFmpeg">
<meta name="twitter:card" content="summary">
    

    

    
        <link rel="icon" href="https://avatars.githubusercontent.com/u/7345875?v=3" />
    

    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/dracula.min.css">
    

    
<link rel="stylesheet" href="/libs/font-awesome5/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/libs/font-awesome5/css/fa-brands.min.css">

    
<link rel="stylesheet" href="/libs/font-awesome5/css/fa-solid.min.css">

    
<link rel="stylesheet" href="/libs/open-sans/styles.css">

    
<link rel="stylesheet" href="/libs/source-code-pro/styles.css">


    
<link rel="stylesheet" href="/css/style.css">


    
<script src="/libs/jquery/2.1.3/jquery.min.js"></script>

    
    
        
<link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">

    
    
        
<link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">

    
    
    
    


<meta name="generator" content="Hexo 4.2.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">花嫁達の部屋</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/archives">文章存档</a>
                
                    <a class="main-nav-link" href="/categories/Tech/">技术乱炖</a>
                
                    <a class="main-nav-link" href="/categories/ACGN/">二维空间</a>
                
                    <a class="main-nav-link" href="/categories/Misc/Thoughts/">所思所想</a>
                
                    <a class="main-nav-link" href="/tags/English-Version/">English</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="https://avatars.githubusercontent.com/u/7345875?v=3" />
                            <i class="fas fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fas fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/archives">文章存档</a></td>
                
                    <td><a class="main-nav-link" href="/categories/Tech/">技术乱炖</a></td>
                
                    <td><a class="main-nav-link" href="/categories/ACGN/">二维空间</a></td>
                
                    <td><a class="main-nav-link" href="/categories/Misc/Thoughts/">所思所想</a></td>
                
                    <td><a class="main-nav-link" href="/tags/English-Version/">English</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile" class="profile-fixed">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="https://avatars.githubusercontent.com/u/7345875?v=3" />
            <h2 id="name">头蟹床(Headcrabbed)</h2>
            <h3 id="title">THE iDOLM@STER</h3>
            <span id="location"><i class="fas fa-map-marker-alt" style="padding-right: 5px"></i>localhost</span>
            <a id="follow" target="_blank" href="https://github.com/hozuki">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                311
                <span>posts</span>
            </div>
            <div class="article-info-block">
                75
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        
                        <a href="https://github.com/hozuki" target="_blank" title="GitHub" class=tooltip>
                            <i class="fab fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        
                        <a href="mailto:uiharu@buaa.edu.cn" target="_blank" title="Email" class=tooltip>
                            <i class="fa fa-envelope"></i>
                        </a>
                    </td>
                    
                    <td>
                        
                        <a href="/atom.xml" target="_blank" title="RSS Feed" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                    <td>
                        
                        <a href="https://twitter.com/headcrabbed" target="_blank" title="Twitter" class=tooltip>
                            <i class="fab fa-twitter"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
        
	<div class="music-info profile-block">
	  <div class="music-container">
        <a class="music-info-list-url" href="https://music.163.com/#/playlist?id=81647846" target="_blank">Playlist #81647846</a>
		<div>
			<iframe class="music-player" frameborder="no" border="0" marginwidth="0" marginheight="0" height=450 src="https://music.163.com/outchain/player?type=0&id=81647846&auto=0&height=430"></iframe>
		</div>
	  </div>
	</div>
	
    </div>
</aside>

            
            <section id="main"><article id="post-zh/2014-04-03-Using-SDL2-and-FFmpeg-to-Build-A-Simple-Player-and-Synchornization" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            博客园第一篇——SDL2+FFmpeg 制作简单播放器与同步
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/categories/Tech/Coding/zh/2014-04-03-Using-SDL2-and-FFmpeg-to-Build-A-Simple-Player-and-Synchornization/">
            <time datetime="2014-04-03T14:54:00.000Z" itemprop="datePublished">2014-04-03</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fas fa-folder"></i>
        <a class="article-category-link" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right"></i><a class="article-category-link" href="/categories/Tech/Coding/">Coding</a>
    </div>

                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/FFmpeg/" rel="tag">FFmpeg</a>, <a class="tag-link" href="/tags/SDL2/" rel="tag">SDL2</a>, <a class="tag-link" href="/tags/%E5%8D%9A%E5%AE%A2%E5%9B%AD%E8%AE%B0%E5%BD%95/" rel="tag">博客园记录</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><a href="http://www.cnblogs.com/GridScience/p/3643428.html" target="_blank" rel="noopener">博客园地址</a></p>
<p>原标题：<code>博客园第一篇——SDL2+FFmpeg 制作简单播放器&amp;同步</code>，因为“&amp;”字符无法被百度sitemap插件处理写入 XML，所以改动了标题。</p>
<a id="more"></a>
<p>SDL 2.0.3; FFmpeg 20140402 shared;</p>
<p>部分来自 <a href="http://blog.csdn.net/jiqiujia/article/details/22449131" target="_blank" rel="noopener">http://blog.csdn.net/jiqiujia/article/details/22449131</a> 的第二个例子，修正了一些问题。</p>
<p>原来的代码在第555行，<code>SDL_Delay(50)</code> 应该替换为 <code>av_free_packet(&amp;packet)</code>，这样既解决了迟滞问题还解决了一个坑爹的内存泄露问题。（我才不会告诉你我播放一个稍微大点的视频在8秒之后 2 GB 内存就被吃掉了呢！）</p>
<p><a href="https://github.com/phamquy/FFmpeg-tutorial-samples/blob/master/tutorial06.c" target="_blank" rel="noopener">https://github.com/phamquy/FFmpeg-tutorial-samples/blob/master/tutorial06.c</a> 也有一些帮助。</p>
<p>功能：</p>
<ol>
<li>简单播放器；</li>
<li>音频重采样，大部分视频的音频部分都播放正常（也有少部分仍不正常的）；</li>
<li>简单的同步。当前以音频流为基准，对于比较小（&lt;120 MB）的 .mpg/.flv 文件还正常，其他的有各种问题，包括视频仍然过快，或者严重丢帧（建议打开控制台自己看）。</li>
</ol>
<p>下面上代码。部分地方有注释。</p>
<pre><code class="lang-cpp">#define _CRT_SECURE_NO_WARNINGS

extern &quot;C&quot; {
#include &quot;libavutil/opt.h&quot;
#include &quot;libavcodec/avcodec.h&quot;
#include &quot;libavformat/avformat.h&quot;
#include &quot;libswscale/swscale.h&quot;
#include &quot;libswresample/swresample.h&quot;
}
#include &quot;SDL.h&quot;
#include &quot;SDL_image.h&quot;
#include &quot;SDL_thread.h&quot;

#include &lt;iostream&gt;
#include &lt;queue&gt;
using namespace std;

#pragma warning(disable: 4996)

#pragma comment(lib,&quot;avutil.lib&quot;)
#pragma comment(lib,&quot;avcodec.lib&quot;)
#pragma comment(lib,&quot;avformat.lib&quot;)
#pragma comment(lib,&quot;swscale.lib&quot;)
#pragma comment(lib,&quot;swresample.lib&quot;)

#pragma comment(lib,&quot;sdl2.lib&quot;)

#define SDL_AUDIO_BUFFER_SIZE            (1152)
#define AVCODEC_MAX_AUDIO_FRAME_SIZE    (192000)

#if (defined main &amp;&amp; defined __MINGW__)
#undef main
#endif

static Uint8 *audio_chunk;
static Uint32 audio_len;
static Uint8 *audio_pos;

static int64_t audio_pts = 0;
static int64_t audio_dts = 0;
static int64_t video_pts = 0;
static int64_t video_dts = 0;

static AVFrame *g_pFrameYUV;

SDL_Thread *g_pVideoThread;
SDL_mutex *g_pVideoMutex;

static int quit = 0;
static int video_quit = 0;

typedef struct video_thread_params
{
    SwsContext *sws_context;
    SDL_Texture *texture;
    SDL_Renderer *renderer;
    AVCodecContext *vid_codec_context;
    SDL_mutex *video_mutex;
}
video_thread_params;

int video_thread_proc(void *data);

void fill_audio(void *udata, Uint8 *stream, int len){
    if (audio_len == 0)
        return;
    len = (len &gt; audio_len ? audio_len : len);
    SDL_MixAudio(stream, audio_pos, len, SDL_MIX_MAXVOLUME);
    audio_pos += len;
    audio_len -= len;
}

int AudioResampling(AVCodecContext * audio_dec_ctx,
                    AVFrame * pAudioDecodeFrame,
                    int out_sample_fmt,
                    int out_channels,
                    int out_sample_rate,
                    uint8_t* out_buf)
{
    SwrContext * swr_ctx = NULL;
    int data_size = 0;
    int ret = 0;
    int64_t src_ch_layout = audio_dec_ctx-&gt;channel_layout;
    int64_t dst_ch_layout = AV_CH_LAYOUT_STEREO;
    int dst_nb_channels = 0;
    int dst_linesize = 0;
    int src_nb_samples = 0;
    int dst_nb_samples = 0;
    int max_dst_nb_samples = 0;
    uint8_t **dst_data = NULL;
    int resampled_data_size = 0;

    swr_ctx = swr_alloc();
    if (!swr_ctx)
    {
        printf(&quot;swr_alloc error \n&quot;);
        return -1;
    }

    src_ch_layout = (audio_dec_ctx-&gt;channels ==
                     av_get_channel_layout_nb_channels(audio_dec_ctx-&gt;channel_layout)) ?
                     audio_dec_ctx-&gt;channel_layout :
                     av_get_default_channel_layout(audio_dec_ctx-&gt;channels);

    if (out_channels == 1)
    {
        dst_ch_layout = AV_CH_LAYOUT_MONO;
        //printf(&quot;dst_ch_layout: AV_CH_LAYOUT_MONO\n&quot;);
    }
    else if (out_channels == 2)
    {
        dst_ch_layout = AV_CH_LAYOUT_STEREO;
        //printf(&quot;dst_ch_layout: AV_CH_LAYOUT_STEREO\n&quot;);
    }
    else
    {
        dst_ch_layout = AV_CH_LAYOUT_SURROUND;
        //printf(&quot;dst_ch_layout: AV_CH_LAYOUT_SURROUND\n&quot;);
    }

    if (src_ch_layout &lt;= 0)
    {
        printf(&quot;src_ch_layout error \n&quot;);
        return -1;
    }

    src_nb_samples = pAudioDecodeFrame-&gt;nb_samples;
    if (src_nb_samples &lt;= 0)
    {
        printf(&quot;src_nb_samples error \n&quot;);
        return -1;
    }

    av_opt_set_int(swr_ctx, &quot;in_channel_layout&quot;, src_ch_layout, 0);
    av_opt_set_int(swr_ctx, &quot;in_sample_rate&quot;, audio_dec_ctx-&gt;sample_rate, 0);
    av_opt_set_sample_fmt(swr_ctx, &quot;in_sample_fmt&quot;, audio_dec_ctx-&gt;sample_fmt, 0);

    av_opt_set_int(swr_ctx, &quot;out_channel_layout&quot;, dst_ch_layout, 0);
    av_opt_set_int(swr_ctx, &quot;out_sample_rate&quot;, out_sample_rate, 0);
    av_opt_set_sample_fmt(swr_ctx, &quot;out_sample_fmt&quot;, (AVSampleFormat)out_sample_fmt, 0);

    if ((ret = swr_init(swr_ctx)) &lt; 0) {
        printf(&quot;Failed to initialize the resampling context\n&quot;);
        return -1;
    }

    max_dst_nb_samples = dst_nb_samples = av_rescale_rnd(src_nb_samples,
                                                         out_sample_rate, audio_dec_ctx-&gt;sample_rate, AV_ROUND_UP);
    if (max_dst_nb_samples &lt;= 0)
    {
        printf(&quot;av_rescale_rnd error \n&quot;);
        return -1;
    }

    dst_nb_channels = av_get_channel_layout_nb_channels(dst_ch_layout);
    ret = av_samples_alloc_array_and_samples(&amp;dst_data, &amp;dst_linesize, dst_nb_channels,
                                             dst_nb_samples, (AVSampleFormat)out_sample_fmt, 0);
    if (ret &lt; 0)
    {
        printf(&quot;av_samples_alloc_array_and_samples error \n&quot;);
        return -1;
    }


    dst_nb_samples = av_rescale_rnd(swr_get_delay(swr_ctx, audio_dec_ctx-&gt;sample_rate) +
                                    src_nb_samples, out_sample_rate, audio_dec_ctx-&gt;sample_rate, AV_ROUND_UP);
    if (dst_nb_samples &lt;= 0)
    {
        printf(&quot;av_rescale_rnd error \n&quot;);
        return -1;
    }
    if (dst_nb_samples &gt; max_dst_nb_samples)
    {
        av_free(dst_data[0]);
        ret = av_samples_alloc(dst_data, &amp;dst_linesize, dst_nb_channels,
                               dst_nb_samples, (AVSampleFormat)out_sample_fmt, 1);
        max_dst_nb_samples = dst_nb_samples;
    }

    if (swr_ctx)
    {
        ret = swr_convert(swr_ctx, dst_data, dst_nb_samples,
                          (const uint8_t **)pAudioDecodeFrame-&gt;data, pAudioDecodeFrame-&gt;nb_samples);
        if (ret &lt; 0)
        {
            printf(&quot;swr_convert error \n&quot;);
            return -1;
        }

        resampled_data_size = av_samples_get_buffer_size(&amp;dst_linesize, dst_nb_channels,
                                                         ret, (AVSampleFormat)out_sample_fmt, 1);
        if (resampled_data_size &lt; 0)
        {
            printf(&quot;av_samples_get_buffer_size error \n&quot;);
            return -1;
        }
    }
    else
    {
        printf(&quot;swr_ctx null error \n&quot;);
        return -1;
    }

    memcpy(out_buf, dst_data[0], resampled_data_size);

    if (dst_data)
    {
        av_freep(&amp;dst_data[0]);
    }
    av_freep(&amp;dst_data);
    dst_data = NULL;

    if (swr_ctx)
    {
        swr_free(&amp;swr_ctx);
    }
    return resampled_data_size;
}

//创建一个全局的结构体变量以便于我们从文件中得到的声音包有地方存
//放同时也保证SDL中的声音回调函数audio_callback 能从这个地方得到声音数据
typedef struct PacketQueue{
    AVPacketList *first_pkt, *last_pkt;
    int nb_packets;
    int size;
    SDL_mutex *mutex;//因为SDL 是在一个独立的线程中来进行音频处理的。如果我们没有正确的锁定这个队列，我们有可能把数据搞乱。
    SDL_cond *cond;
}PacketQueue;

PacketQueue audioq;
PacketQueue videoq;
queue&lt;AVFrame *&gt; frameq;

void packet_queue_init(PacketQueue *pq){
    memset(pq, 0, sizeof(PacketQueue));
    pq-&gt;mutex = SDL_CreateMutex();
    pq-&gt;cond = SDL_CreateCond();
}

int packet_queue_put(PacketQueue *q, AVPacket *pkt){
    AVPacketList *pkt1;
    /*(
    if (av_dup_packet(pkt) &lt; 0){
        printf(&quot;error&quot;);
        return -1;
    }
    */

    pkt1 = (AVPacketList*)av_malloc(sizeof(AVPacketList));
    if (!pkt1){
        printf(&quot;error&quot;);
        return -1;
    }

    av_copy_packet(&amp;pkt1-&gt;pkt, pkt);
    av_free_packet(pkt);
    pkt1-&gt;next = NULL;

    //函数SDL_LockMutex()锁定队列的互斥量以便于我们向队列中添加东西，然后函
    //数SDL_CondSignal()通过我们的条件变量为一个接 收函数（如果它在等待）发
    //出一个信号来告诉它现在已经有数据了，接着就会解锁互斥量并让队列可以自由
    //访问。
    SDL_LockMutex(q-&gt;mutex);

    if (!q-&gt;last_pkt)//队列为空
        q-&gt;first_pkt = pkt1;
    else//队列不为空
        q-&gt;last_pkt-&gt;next = pkt1;
    q-&gt;last_pkt = pkt1;
    q-&gt;nb_packets++;
    q-&gt;size += pkt1-&gt;pkt.size;
    SDL_CondSignal(q-&gt;cond);

    SDL_UnlockMutex(q-&gt;mutex);

    return 0;
}

int decode_interrupt_cb(void){
    return quit;
}

static int packet_queue_get(PacketQueue *q, AVPacket *pkt, int block){
    AVPacketList *pkt1;
    int ret;

    SDL_LockMutex(q-&gt;mutex);

    for (;;){
        if (quit){
            ret = -1;
            break;
        }

        pkt1 = q-&gt;first_pkt;
        if (pkt1){
            q-&gt;first_pkt = pkt1-&gt;next;
            if (!q-&gt;first_pkt)
                q-&gt;last_pkt = NULL;
            q-&gt;nb_packets--;
            q-&gt;size -= pkt1-&gt;pkt.size;
            //*pkt = pkt1-&gt;pkt;
            av_copy_packet(pkt, &amp;pkt1-&gt;pkt);
            av_free_packet(&amp;pkt1-&gt;pkt);
            av_free(pkt1);
            ret = 1;
            break;
        }
        else if (!block){
            ret = 0;
            break;
        }
        else{
            SDL_CondWait(q-&gt;cond, q-&gt;mutex);
        }
    }
    SDL_UnlockMutex(q-&gt;mutex);
    return ret;
}

int audio_decode_frame(AVCodecContext *aCodecCtx, uint8_t *audio_buf, int buf_size){
    static AVPacket pkt;
    static uint8_t *audio_pkt_data = NULL;
    static int audio_pkt_size = 0;

    int len1, data_size, ret = 0;

    static AVFrame *pFrame;
    pFrame = av_frame_alloc();

    /*if (packet_queue_get(&amp;audioq, &amp;pkt, 1) &lt; 0){//从这里开始，取得main线程放入队列的包
    printf(&quot;error, can&#39;t get packet from the queue&quot;);
    return -1;
    }

    len1 = avcodec_decode_audio4(aCodecCtx, pFrame, &amp;ret, &amp;pkt);
    if (len1 &lt; 0)
    return -1;

    return AudioResampling(aCodecCtx, pFrame, AV_SAMPLE_FMT_S16, 2, 44100, audio_buf);*/
    for (;;){
        while (audio_pkt_size &gt; 0){
            data_size = buf_size;
            len1 = avcodec_decode_audio4(aCodecCtx, pFrame, &amp;ret, &amp;pkt);

            //len1 = avcodec_decode_audio3(aCodecCtx, (int16_t *)audio_buf,
            //    &amp;data_size, &amp;pkt);
            if (len1 &lt; 0){//if error, skip frame
                printf(&quot;error\n&quot;);
                audio_pkt_size = 0;
                break;
            }
            data_size = AudioResampling(aCodecCtx, pFrame, AV_SAMPLE_FMT_S16, 2, 44100, audio_buf);
            audio_pkt_data += len1;
            audio_pkt_size -= len1;
            if (data_size &lt;= 0)//No data yet, get more frames
                continue;
            return data_size;
        }
        //if (pkt.data)
            av_free_packet(&amp;pkt);
        if (quit)
            return -1;
        if (packet_queue_get(&amp;audioq, &amp;pkt, 1) &lt; 0){//从这里开始，取得main线程放入队列的包
            printf(&quot;error, can&#39;t get packet from the queue&quot;);
            return -1;
        }

        //SDL_LockMutex(g_pVideoMutex);
        audio_pts = pkt.pts;
        audio_dts = pkt.dts;
        //SDL_UnlockMutex(g_pVideoMutex);

        audio_pkt_data = pkt.data;
        audio_pkt_size = pkt.size;
    }
}
//声音回调函数
//userdata是输入，stream是输出，len是输入，len的值一般为4096（调试中发现的），
//audio_callback函数的功能是调用audio_decode_frame函数，把解码后数据块audio_buf追加在stream的后面，
//通过SDL库对audio_callback的不断调用，不断解码数据，然后放到stream的末尾，
//SDL库认为stream中数据够播放一帧音频了，就播放它,
//第三个参数len是向stream中写数据的内存分配尺度，是分配给audio_callback函数写入缓存大小。
void audio_callback(void *userdata, Uint8 *stream, int len){
    //SDL_memset(stream, 0, len);
    AVCodecContext *aCodecCtx = (AVCodecContext*)userdata;
    int len1, audio_size;

    //audio_buf 的大小为 1.5 倍的声音帧的大    小以便于有一个比较好的缓冲
    static uint8_t audio_buf[(AVCODEC_MAX_AUDIO_FRAME_SIZE * 3) / 2];
    static unsigned int audio_buf_size = 0;
    static unsigned int audio_buf_index = 0;

    while (len &gt; 0){
        if (audio_buf_index &gt;= audio_buf_size){//already send all our data, get more
            audio_size = audio_decode_frame(aCodecCtx, audio_buf, sizeof(audio_buf));
            if (audio_size &lt; 0){//error, output silence
                printf(&quot;error, output silence\n&quot;);
                audio_buf_size = SDL_AUDIO_BUFFER_SIZE;
                memset(audio_buf, 0, audio_buf_size);
            }
            else
                audio_buf_size = audio_size;
            audio_buf_index = 0;
        }
        len1 = audio_buf_size - audio_buf_index;
        if (len1&gt;len){
            len1 = len;
        }
        memcpy(stream, (uint8_t *)audio_buf + audio_buf_index, len1);
        len -= len1;
        stream += len1;
        audio_buf_index += len1;
    }
}

// 视频流处理线程
// 这里对齐是以音频流为准的
// 所以如果音频流（相对于视频流）过于稀疏的话，就会失去作用，效果不好

int video_thread_proc(void *data)
{
    video_thread_params *params = (video_thread_params *)data;
    AVFrame *pFrame = NULL;
    AVFrame *pNextFrame = NULL;
    AVPacket packet = {0};
    AVPacket nextpacket;

    // 注意，以下代码比较的都是 DTS（解压缩时间戳）而不是 PTS（显示时间戳）！！！
    // 实际视频显示是以 PTS 为准的，但是 PTS 大多没有规律（只要是在解压之后就好），难以处理
    // 所幸在相当一部分视频中 DTS 与 PTS 相差较小，所以这里就用 DTS 了

    while (!video_quit)
    {
        while (!frameq.empty())
        {
            if (pFrame == NULL)
            {
                SDL_LockMutex(params-&gt;video_mutex);

                // 这里采用了“连续读取”的方法，也即如果下一帧的 DTS 小于当前基准（目前采用音频流），则循环直至找到第一个 DTS 比基准大的
                // 然后播放小于基准而且离基准最近的帧，并缓存下一帧
                // 由于处理时间较长，而且使用了互斥体（看，音频部分也用到了），所以可能有极少数的音频帧有异常（噪声啊之类的）
                // 当然也可以将这一段注释掉，采用 pFrame = frameq.count(); frameq.pop();，同时解除 if (packet_queue_get()) 的注释（和下面的一对大括号）
                // 但是无跳过的方法会导致视频严重滞后

                if (pNextFrame != NULL)
                {
                    pFrame = pNextFrame;
                    SDL_memcpy(&amp;packet, &amp;nextpacket, sizeof(AVPacket));
                    pNextFrame = NULL;
                }
                else
                {
                    pFrame = frameq.front();
                    frameq.pop();
                }
                while (!frameq.empty())
                {
                    pNextFrame = frameq.front();
                    frameq.pop();
                    packet_queue_get(&amp;videoq, &amp;nextpacket, 1);

                    if (nextpacket.dts &lt;= audio_dts)
                    {
                        av_free_packet(&amp;packet);
                        av_frame_free(&amp;pFrame);
                        SDL_memcpy(&amp;packet, &amp;nextpacket, sizeof(AVPacket));
                        pFrame = pNextFrame;
                        pNextFrame = NULL;
                    }
                    else
                    {
                        break;
                    }
                }


                //pFrame = frameq.front();
                //frameq.pop();


                //cout &lt;&lt; &quot;vdts: &quot; &lt;&lt; packet.dts &lt;&lt; &quot; adts: &quot; &lt;&lt; audio_dts &lt;&lt; endl;

                //if (packet_queue_get(&amp;videoq, &amp;packet, 1) &gt;= 0)
                //{
                    sws_scale(params-&gt;sws_context, (const uint8_t* const*)pFrame-&gt;data,
                              pFrame-&gt;linesize, 0, params-&gt;vid_codec_context-&gt;height, g_pFrameYUV-&gt;data, g_pFrameYUV-&gt;linesize);

                    SDL_UpdateYUVTexture(params-&gt;texture, NULL, g_pFrameYUV-&gt;data[0], g_pFrameYUV-&gt;linesize[0],
                                         g_pFrameYUV-&gt;data[1], g_pFrameYUV-&gt;linesize[1], g_pFrameYUV-&gt;data[2], g_pFrameYUV-&gt;linesize[2]);

                    //SDL_RenderClear(params-&gt;renderer);
                    SDL_RenderCopy(params-&gt;renderer, params-&gt;texture, NULL, NULL);
                    SDL_RenderPresent(params-&gt;renderer);
                    // 可以使用 av_frame_clone() + 队列 实现“远程”dts 读取
                    //if (params-&gt;vid_codec_context-&gt;refcounted_frames)
                    //{
                    //    av_frame_unref(pFrame);
                    //}
                //}

                //cout &lt;&lt; &quot;--------------------------------------------------&quot; &lt;&lt; endl;
                //cout &lt;&lt; &quot;vidpts: &quot; &lt;&lt; packet.pts &lt;&lt; &quot; audpts: &quot; &lt;&lt; audio_pts &lt;&lt; endl;
                //cout &lt;&lt; &quot;viddts: &quot; &lt;&lt; packet.dts &lt;&lt; &quot; auddts: &quot; &lt;&lt; audio_dts &lt;&lt; endl;

                SDL_UnlockMutex(params-&gt;video_mutex);
            }
            else
            {
                //cout &lt;&lt; &quot;vdts: &quot; &lt;&lt; packet.dts &lt;&lt; &quot; adts: &quot; &lt;&lt; audio_dts &lt;&lt; endl;

                // 如果当前帧应该用被缓存的帧，那就用，不要重新读取了

                sws_scale(params-&gt;sws_context, (const uint8_t* const*)pFrame-&gt;data,
                          pFrame-&gt;linesize, 0, params-&gt;vid_codec_context-&gt;height, g_pFrameYUV-&gt;data, g_pFrameYUV-&gt;linesize);

                SDL_UpdateYUVTexture(params-&gt;texture, NULL, g_pFrameYUV-&gt;data[0], g_pFrameYUV-&gt;linesize[0],
                                     g_pFrameYUV-&gt;data[1], g_pFrameYUV-&gt;linesize[1], g_pFrameYUV-&gt;data[2], g_pFrameYUV-&gt;linesize[2]);

                //SDL_RenderClear(params-&gt;renderer);
                SDL_RenderCopy(params-&gt;renderer, params-&gt;texture, NULL, NULL);
                SDL_RenderPresent(params-&gt;renderer);
                // 可以使用 av_frame_clone() + 队列 实现“远程”dts 读取
                if (params-&gt;vid_codec_context-&gt;refcounted_frames)
                {
                    av_frame_unref(pFrame);
                }

                // 如果该帧是在音频帧之前的，那就销毁它，和数据包
                if (packet.dts &lt;= audio_dts)
                {
                    av_frame_free(&amp;pFrame);
                    av_free_packet(&amp;packet);
                    pFrame = NULL;
                }
            }

        }
    }

    return 0;
}

int main(int argc, char *argv[])
{
    av_register_all();    //注册了所有的文件格式和编解码的库，它们将被自动的使用在被打开的合适格式的文件上
    AVFormatContext *pFormatCtx;
    pFormatCtx = avformat_alloc_context();

    if (argc &lt; 2) return 0;
    //Open an input stream and read the header
    if (avformat_open_input(&amp;pFormatCtx, argv[1], NULL, NULL) != 0){
        printf(&quot;Can&#39;t open the file\n&quot;);
        return -1;
    }
    //Retrieve stream information
    if (avformat_find_stream_info(pFormatCtx, NULL) &lt; 0){
        printf(&quot;Couldn&#39;t find stream information.\n&quot;);
        return -1;
    }

    //output file information
    cout &lt;&lt; &quot;文件信息----------------------------------&quot; &lt;&lt; endl;
    av_dump_format(pFormatCtx, 0, argv[1], 0);
    cout &lt;&lt; &quot;--------------------------------------------&quot; &lt;&lt; endl;

    int i, videoIndex, audioIndex;

    //Find the first video stream
    videoIndex = -1;
    audioIndex = -1;
    for (i = 0; i &lt; pFormatCtx-&gt;nb_streams; i++){//视音频流的个数
        if (pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type == AVMEDIA_TYPE_VIDEO
            &amp;&amp; videoIndex &lt; 0){
            videoIndex = i;
        }
        if (pFormatCtx-&gt;streams[i]-&gt;codec-&gt;codec_type == AVMEDIA_TYPE_AUDIO
            &amp;&amp; audioIndex &lt; 0)
            audioIndex = i;
    }

    if (videoIndex == -1)
        return -1;
    if (audioIndex == -1)
        return -1;

    AVCodecContext *pCodecCtx, *paCodecCtx;
    AVCodec *pCodec, *paCodec;
    //Get a pointer to the codec context for the video stream
    //流中关于编解码器的信息就是被我们叫做&quot;codec context&quot;（编解码器上下文）
    //的东西。这里面包含了流中所使用的关于编解码器的所有信
    pCodecCtx = pFormatCtx-&gt;streams[videoIndex]-&gt;codec;
    // 帧引用：打开，见 AVFrame 的注释
    pCodecCtx-&gt;refcounted_frames = 1;
    paCodecCtx = pFormatCtx-&gt;streams[audioIndex]-&gt;codec;
    //Find the decoder for the video stream
    pCodec = avcodec_find_decoder(pCodecCtx-&gt;codec_id);
    paCodec = avcodec_find_decoder(paCodecCtx-&gt;codec_id);

    if (pCodec == NULL || paCodecCtx == NULL){
        printf(&quot;Unsupported codec!\n&quot;);
        return -1;
    }
    //Open codec
    if (avcodec_open2(pCodecCtx, pCodec, NULL) &lt; 0){
        printf(&quot;Could not open video codec.\n&quot;);
        return -1;
    }
    if (avcodec_open2(paCodecCtx, paCodec, NULL) &lt; 0){
        printf(&quot;Could not open audio codec.\n&quot;);
        return -1;
    }

    //--------------------------------------------------------//

    printf(&quot;比特率 %3d\n&quot;, pFormatCtx-&gt;bit_rate);
    printf(&quot;解码器名称 %s\n&quot;, paCodecCtx-&gt;codec-&gt;long_name);
    printf(&quot;time_base  %d \n&quot;, paCodecCtx-&gt;time_base);
    printf(&quot;声道数  %d \n&quot;, paCodecCtx-&gt;channels);
    printf(&quot;sample per second  %d \n&quot;, paCodecCtx-&gt;sample_rate);
    //--------------------------------------------------------//

    //allocate video frame and set its fileds to default value
    AVFrame *pFrame;
    //AVFrame *pFrameYUV;
    pFrame = av_frame_alloc();
    g_pFrameYUV = av_frame_alloc();

    //即使我们申请了一帧的内存，当转换的时候，我们仍然需要一个地方来放置原始
    //的数据。我们使用avpicture_get_size 来获得我们需要的大小， 然后手工申请
    //内存空间：
    uint8_t *out_buffer;
    int numBytes;
    numBytes = avpicture_get_size(PIX_FMT_YUV420P, pCodecCtx-&gt;width, pCodecCtx-&gt;height);
    //av_malloc 是ffmpeg 的malloc，用来实现一个简单的malloc 的包装，这样来保
    //证内存地址是对齐的（4 字节对齐或者2 字节对齐）。它并不能保 护你不被内
    //存泄漏，重复释放或者其它malloc 的问题所困扰。
    out_buffer = (uint8_t *)av_malloc(numBytes*sizeof(uint8_t));
    //Assign appropriate parts of buffer to image planes in pFrameYUV
    //Note that pFrameYUV is an AVFrame, but AVFrame is a superset of AVPicture
    avpicture_fill((AVPicture*)g_pFrameYUV, out_buffer, PIX_FMT_YUV420P, pCodecCtx-&gt;width, pCodecCtx-&gt;height);

    //----------------SDL--------------------------------------//
    if (SDL_Init(SDL_INIT_VIDEO | SDL_INIT_AUDIO | SDL_INIT_TIMER)){
        printf(&quot;Could not initialize SDL -%s\n&quot;, SDL_GetError());
        exit(1);
    }
    //先设置声音的选项：采样率，声音通道数和其它的参 数，然后我们
    //设置一个回调函数和一些用户数据userdata。当开始播放音频的时候，SDL 将不
    //断地调用这个回调函数并且要求它来向声音缓冲填入一个特定的数量的字节。
    //当我们把这些信息放到SDL_AudioSpec 结构体中后，我们调用函数
    //SDL_OpenAudio()就会打开声音设备并且给我们送 回另外一个AudioSpec 结构
    //体。这个结构体是我们实际上用到的－－因为我们不能保证得到我们所要求的。
    SDL_AudioSpec wanted_spec;
    wanted_spec.freq = paCodecCtx-&gt;sample_rate;
    wanted_spec.format = AUDIO_S16SYS;
    wanted_spec.channels = paCodecCtx-&gt;channels;    //声音的通道数
    wanted_spec.silence = 0;    //用来表示静音的值
    wanted_spec.samples = SDL_AUDIO_BUFFER_SIZE;    //声音缓冲区的大小
    wanted_spec.callback = audio_callback;
    wanted_spec.userdata = paCodecCtx;

    if (SDL_OpenAudio(&amp;wanted_spec, NULL) &lt; 0){
        printf(&quot;SDL_OpenAudio error: %s\n&quot;, SDL_GetError());
        return -1;
    }

    packet_queue_init(&amp;audioq);
    packet_queue_init(&amp;videoq);
    SDL_PauseAudio(0);

    SDL_Window *window = nullptr;
    window = SDL_CreateWindow(&quot;MPlayer&quot;, SDL_WINDOWPOS_CENTERED, SDL_WINDOWPOS_CENTERED,
                              pCodecCtx-&gt;width, pCodecCtx-&gt;height, SDL_WINDOW_SHOWN);
    if (!window){
        cout &lt;&lt; SDL_GetError() &lt;&lt; endl;
        return 1;
    }

    SDL_Renderer *ren = nullptr;
    ren = SDL_CreateRenderer(window, -1, SDL_RENDERER_ACCELERATED | SDL_RENDERER_PRESENTVSYNC);
    if (ren == nullptr){
        cout &lt;&lt; SDL_GetError() &lt;&lt; endl;
        return -1;
    }

    SDL_Texture *texture = nullptr;
    texture = SDL_CreateTexture(ren, SDL_PIXELFORMAT_YV12,
                                SDL_TEXTUREACCESS_STREAMING, pCodecCtx-&gt;width, pCodecCtx-&gt;height);

    //*************************************************************//
    //通过读取包来读取整个视频流，然后把它解码成帧，最后转换格式并且保存
    int frameFinished;
    //int psize = pCodecCtx-&gt;width * pCodecCtx-&gt;height;
    AVPacket packet;
    av_new_packet(&amp;packet, numBytes);

    i = 0;
    int ret;
    static struct SwsContext *img_convert_ctx;
    img_convert_ctx = sws_getContext(pCodecCtx-&gt;width, pCodecCtx-&gt;height,
                                     pCodecCtx-&gt;pix_fmt, pCodecCtx-&gt;width, pCodecCtx-&gt;height, PIX_FMT_YUV420P,
                                     SWS_BICUBIC, NULL, NULL, NULL);

    SDL_Event ev;

    video_thread_params vtp;
    vtp.renderer = ren;
    vtp.texture = texture;
    vtp.sws_context = img_convert_ctx;
    vtp.vid_codec_context = pCodecCtx;
    vtp.video_mutex = SDL_CreateMutex();
    g_pVideoMutex = vtp.video_mutex;
    g_pVideoThread = SDL_CreateThread(video_thread_proc, &quot;video_thread&quot;, &amp;vtp);

    double v_a_ratio;            // 视频帧数/音频帧数
    int frame_queue_size;

    //Read the next frame of a stream
    while ((!quit) &amp;&amp; (av_read_frame(pFormatCtx, &amp;packet) &gt;= 0 || (!frameq.empty())))
    {
        //Is this a packet from the video stream?
        if (packet.stream_index == videoIndex)
        {
            //decode video frame of size packet.size from packet.data into picture
            ret = avcodec_decode_video2(pCodecCtx, pFrame, &amp;frameFinished, &amp;packet);
            //Did we get a video frame?
            if (ret &gt;= 0)
            {
                //Convert the image from its native format to YUV
                if (frameFinished)
                {
                    /*
                    sws_scale(img_convert_ctx, (const uint8_t* const*)pFrame-&gt;data,
                    pFrame-&gt;linesize, 0, pCodecCtx-&gt;height, g_pFrameYUV-&gt;data, g_pFrameYUV-&gt;linesize);

                    SDL_UpdateYUVTexture(texture, NULL, g_pFrameYUV-&gt;data[0], g_pFrameYUV-&gt;linesize[0],
                    g_pFrameYUV-&gt;data[1], g_pFrameYUV-&gt;linesize[1], g_pFrameYUV-&gt;data[2], g_pFrameYUV-&gt;linesize[2]);

                    AVFrame *pNewFrame = av_frame_clone(pFrame);
                    frameq.push(pNewFrame);
                    packet_queue_put(&amp;videoq, &amp;packet);

                    SDL_RenderClear(ren);
                    SDL_RenderCopy(ren, texture, NULL, NULL);
                    SDL_RenderPresent(ren);
                    // 可以使用 av_frame_clone() + 队列 实现远程 dts 读取
                    if (pCodecCtx-&gt;refcounted_frames)
                    {
                    av_frame_unref(pFrame);
                    }
                    cout &lt;&lt; &quot;&lt;&lt;&lt;&lt;&lt;&lt;&quot; &lt;&lt; endl;
                    cout &lt;&lt; &quot;vpts: &quot; &lt;&lt; packet.pts &lt;&lt; &quot;, apts: &quot; &lt;&lt; audio_pts &lt;&lt; endl;
                    cout &lt;&lt; &quot;vdts: &quot; &lt;&lt; packet.dts &lt;&lt; &quot;, adts: &quot; &lt;&lt; audio_dts &lt;&lt; endl;
                    */
                    // 用互斥体保持同步，将包送入队列，让另外的线程自己处理
                    SDL_LockMutex(vtp.video_mutex);
                    packet_queue_put(&amp;videoq, &amp;packet);
                    AVFrame *pNewFrame = av_frame_clone(pFrame);
                    frameq.push(pNewFrame);
                    //cout &lt;&lt; &quot;Pushing vpacket.&quot; &lt;&lt; endl;
                    SDL_UnlockMutex(vtp.video_mutex);
                }
                // 注意这里也必须要 free packet，否则会导致严重内存泄露
                // 我修改了 packet_queue_put() 函数，它会复制 packet，所以可以放心释放上
                av_free_packet(&amp;packet);
            }
            else{
                av_free_packet(&amp;packet);
                cout &lt;&lt; &quot;decode error&quot; &lt;&lt; endl;
                return -1;
            }
        }
        else if (packet.stream_index == audioIndex){
            //packet_queue_put(&amp;audioq, &amp;packet);
            /*ret = avcodec_decode_audio4(paCodecCtx, pFrame, &amp;frameFinished, &amp;packet);
            cout &lt;&lt; pFrame-&gt;format &lt;&lt; endl;

            if (ret &lt; 0){
            printf(&quot;Error in decoding audio frame\n&quot;);
            exit(0);
            }
            if (frameFinished){
            printf(&quot;pts %5d\n&quot;, packet.pts);
            printf(&quot;dts %5d\n&quot;, packet.dts);
            printf(&quot;packet_size %5d\n&quot;, packet.size);
            }
            audio_chunk = (Uint8*)pFrame-&gt;data[0];
            audio_len = pFrame-&gt;linesize[0];

            audio_pos = audio_chunk;
            //SDL_PauseAudio(0);
            while (audio_len&gt;0)
            SDL_Delay(1);*/
            packet_queue_put(&amp;audioq, &amp;packet);
        }
        else
        {
            av_free_packet(&amp;packet);
        }

process_sdl_events:
        if (SDL_PollEvent(&amp;ev))
        {
            switch (ev.type){
                case SDL_QUIT:
                {
                    quit = 1;
                    video_quit = 1;
                    SDL_Quit();
                    goto exit_line;
                    break;
                }
                case SDL_KEYDOWN:
                    if (ev.key.keysym.scancode == SDL_SCANCODE_ESCAPE)
                    {
                        quit = 1;
                        video_quit = 1;
                        SDL_Quit();
                        goto exit_line;
                        break;
                    }
                default:
                    break;
            }
        }

        //cout &lt;&lt; &quot;vframes: &quot; &lt;&lt; pCodecCtx-&gt;frame_number &lt;&lt; &quot; aframes: &quot; &lt;&lt; paCodecCtx-&gt;frame_number &lt;&lt; endl;

        // 设置一个缓冲区大小，如果超过此大小则暂停处理（视频和音频）帧
        // 这里采用限制 frameq 的大小的方法
        // 如果采用以下的动态代码，有可能导致结尾“崩坏”，囧
        /*
        if (paCodecCtx-&gt;frame_number == 0)
        {
            v_a_ratio = 300;        // 一个很大的值，基本上能保证所有视频都能解码
        }
        else
        {
            v_a_ratio = pCodecCtx-&gt;frame_number / (double)paCodecCtx-&gt;frame_number;
            if (v_a_ratio &lt; 10.0) v_a_ratio = 10.0;
        }

        frame_queue_size = (int)v_a_ratio * 2;
        if (frameq.size() &gt; frame_queue_size) goto process_sdl_events;
        */
        if (frameq.size() &gt; 50) goto process_sdl_events;
    }

exit_line:

    SDL_DestroyMutex(vtp.video_mutex);

    SDL_DestroyTexture(texture);

    av_frame_free(&amp;pFrame);
    av_frame_free(&amp;g_pFrameYUV);

    avcodec_close(pCodecCtx);

    avformat_close_input(&amp;pFormatCtx);

    return 0;
}
</code></pre>

        
        </div>
        <footer class="article-footer">
            
                <div class="copyright">
    <table>
        <tbody>
        <tr>
            <td class="copyright-entry">作者：</td><td class="copyright-value"><a href="https://blog.mottomo.moe">头蟹床(Headcrabbed)</a></td>
        </tr>
        <tr>
            <td class="copyright-entry">标题：</td><td class="copyright-value">博客园第一篇——SDL2+FFmpeg 制作简单播放器与同步</td>
        </tr>
        <tr>
            <td class="copyright-entry">URL：</td><td class="copyright-value"><a href="/categories/Tech/Coding/zh/2014-04-03-Using-SDL2-and-FFmpeg-to-Build-A-Simple-Player-and-Synchornization/">https://blog.mottomo.moe/categories/Tech/Coding/zh/2014-04-03-Using-SDL2-and-FFmpeg-to-Build-A-Simple-Player-and-Synchornization/</a></td>
        </tr>
        </tbody>
    </table>
    <p class="copyright-reprint-rule">
        如果您觉得这篇文章对您有帮助，欢迎按照下面的许可进行转载。转载请注明来源。<br/>If you find this article helpful, you are welcome to reprint it following the license below, with source credited.
    </p>
    <p class="copyright-reprint-rule">
        
    </p>
    <p class="copyright-cc">
      <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/" target="_blank"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/3.0/cn/88x31.png" /></a>
      <span class="copyright-cc-text">&nbsp;本作品采用
      <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/" target="_blank">知识共享署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议</a>
      进行许可。<br/>&nbsp;This work is licensed under <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.en" target="_blank">CC BY-NC-SA 3.0 CN License</a>.</span>
    </p>
</div>

                <div class="donate">
    <table class="donate-desc">
        <tbody>
        <tr>
            <td>如果您觉得这篇文章对您很有帮助，不妨捐助一下。</td>
        </tr>
        <tr>
            <td>If you find this article really helpful, you can buy me a coffee. :P</td>
        </tr>
        </tbody>
    </table>
    <table class="donate-method">
        <tbody>
        <tr>
            <td>PayPal</td>
            <td><a href="https://paypal.me/headcrabbed" target="_blank" rel="noopener">https://paypal.me/headcrabbed</a></td>
        </tr>
        </tbody>
    </table>
</div>

            
            <div class="share-container">



</div>

    <a data-url="https://blog.mottomo.moe/categories/Tech/Coding/zh/2014-04-03-Using-SDL2-and-FFmpeg-to-Build-A-Simple-Player-and-Synchornization/" data-id="ck8f3bctg006ivgi86vtt0cnr" class="article-share-link"><i class="fas fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="https://blog.mottomo.moe/categories/Tech/Coding/zh/2014-04-03-Using-SDL2-and-FFmpeg-to-Build-A-Simple-Player-and-Synchornization/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="https://blog.mottomo.moe/categories/Tech/Coding/zh/2014-04-03-Using-SDL2-and-FFmpeg-to-Build-A-Simple-Player-and-Synchornization/">评论</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/categories/Tech/Coding/zh/2014-04-05-Add-S16-Planar-Support-for-OpenAL/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">上一篇</strong>
            <div class="article-nav-title">
                
                    让 OpenAL 也支持 S16 Planar（辅以 FFmpeg）
                
            </div>
        </a>
    
    
        <a href="/categories/Misc/Records/zh/2014-04-03-Records-on-04-03/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">Thu Apr 03 2014 00:00:00 GMT+0200 (GMT+02:00)</div>
        </a>
    
</nav>


    
</article>


    
    
        <section id="comments">
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus</a>.</noscript>
    </div>
</section>
    

</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <!--<ul id="recent-post" class="">-->
                <ul id="recent-post">
                
                    <li class="no-thumbnail">
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right"></i><a class="article-category-link" href="/categories/Tech/Coding/">Coding</a></p>
                            <p class="item-title"><a href="/categories/Tech/Coding/en/2020-07-26-CSharp-Tuple-Element-Names-and-Method-Signatures/" class="title">C# Tuple Element Names and Method Signatures</a></p>
                            <p class="item-date"><time datetime="2020-07-26T11:42:00.000Z" itemprop="datePublished">2020-07-26</time></p>
                        </div>
                    </li>
                
                    <li class="no-thumbnail">
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right"></i><a class="article-category-link" href="/categories/Tech/Coding/">Coding</a></p>
                            <p class="item-title"><a href="/categories/Tech/Coding/zh/2020-07-26-CSharp-Tuple-Element-Names-and-Method-Signatures/" class="title">C# 元组元素名称和方法签名相关</a></p>
                            <p class="item-date"><time datetime="2020-07-26T11:42:00.000Z" itemprop="datePublished">2020-07-26</time></p>
                        </div>
                    </li>
                
                    <li class="no-thumbnail">
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right"></i><a class="article-category-link" href="/categories/Tech/RE/">RE</a></p>
                            <p class="item-title"><a href="/categories/Tech/RE/zh/2020-05-07-MLTD-Skeleton-Curve-Table/" class="title">麻辣土豆新动作的骨骼曲线表</a></p>
                            <p class="item-date"><time datetime="2020-05-07T02:15:00.000Z" itemprop="datePublished">2020-05-07</time></p>
                        </div>
                    </li>
                
                    <li class="no-thumbnail">
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Misc/">Misc</a></p>
                            <p class="item-title"><a href="/categories/Misc/zh/2020-03-31-Site-History-Lost/" class="title">博客提交记录已经丢失</a></p>
                            <p class="item-date"><time datetime="2020-03-31T15:49:00.000Z" itemprop="datePublished">2020-03-31</time></p>
                        </div>
                    </li>
                
                    <li class="no-thumbnail">
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right"></i><a class="article-category-link" href="/categories/Tech/Coding/">Coding</a></p>
                            <p class="item-title"><a href="/categories/Tech/Coding/zh/2020-03-23-FB2K-NEM-Component/" class="title">在 Foobar2000 中直接播放网易云音乐的缓存文件</a></p>
                            <p class="item-date"><time datetime="2020-03-23T06:20:00.000Z" itemprop="datePublished">2020-03-23</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ACGN/">ACGN</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Misc/">Misc</a><span class="category-list-count">179</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Misc/Fun/">Fun</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Misc/Records/">Records</a><span class="category-list-count">80</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Misc/Thoughts/">Thoughts</a><span class="category-list-count">9</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/">Tech</a><span class="category-list-count">117</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/ACGN/">ACGN</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/Coding/">Coding</a><span class="category-list-count">58</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/RE/">RE</a><span class="category-list-count">16</span></li></ul></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/NET/" style="font-size: 10px;">.NET</a> <a href="/tags/3D/" style="font-size: 14.17px;">3D</a> <a href="/tags/Alternative-Girls/" style="font-size: 10px;">Alternative Girls</a> <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/Boost/" style="font-size: 10px;">Boost</a> <a href="/tags/Bulletproof/" style="font-size: 18.33px;">Bulletproof</a> <a href="/tags/CGSS/" style="font-size: 15.83px;">CGSS</a> <a href="/tags/CPlusPlus/" style="font-size: 13.33px;">CPlusPlus</a> <a href="/tags/CSharp/" style="font-size: 10.83px;">CSharp</a> <a href="/tags/DereTore/" style="font-size: 15.83px;">DereTore</a> <a href="/tags/DirectX/" style="font-size: 10.83px;">DirectX</a> <a href="/tags/Dragalia-Lost/" style="font-size: 10.83px;">Dragalia Lost</a> <a href="/tags/English-Version/" style="font-size: 11.67px;">English Version</a> <a href="/tags/FFmpeg/" style="font-size: 11.67px;">FFmpeg</a> <a href="/tags/FGBT-Bangumi-Assistant/" style="font-size: 10px;">FGBT-Bangumi Assistant</a> <a href="/tags/Foobar2000/" style="font-size: 10px;">Foobar2000</a> <a href="/tags/GC/" style="font-size: 10.83px;">GC</a> <a href="/tags/GF-%E2%99%AA/" style="font-size: 10px;">GF(♪)</a> <a href="/tags/GLantern/" style="font-size: 14.17px;">GLantern</a> <a href="/tags/Gal-Game/" style="font-size: 10px;">Gal Game</a> <a href="/tags/Game-Off-2017/" style="font-size: 10px;">Game Off 2017</a> <a href="/tags/HCA/" style="font-size: 12.5px;">HCA</a> <a href="/tags/Hexo/" style="font-size: 10.83px;">Hexo</a> <a href="/tags/JSON/" style="font-size: 10px;">JSON</a> <a href="/tags/Java/" style="font-size: 10.83px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/KeiSystem/" style="font-size: 11.67px;">KeiSystem</a> <a href="/tags/MCI/" style="font-size: 10px;">MCI</a> <a href="/tags/MLTD/" style="font-size: 15.83px;">MLTD</a> <a href="/tags/MSIL/" style="font-size: 10px;">MSIL</a> <a href="/tags/MonoGame/" style="font-size: 10.83px;">MonoGame</a> <a href="/tags/NW-js/" style="font-size: 10px;">NW.js</a> <a href="/tags/Numba/" style="font-size: 10px;">Numba</a> <a href="/tags/OI/" style="font-size: 10px;">OI</a> <a href="/tags/OpenAL/" style="font-size: 10px;">OpenAL</a> <a href="/tags/Paiza/" style="font-size: 10px;">Paiza</a> <a href="/tags/Postfix/" style="font-size: 10px;">Postfix</a> <a href="/tags/PulseAudio/" style="font-size: 10px;">PulseAudio</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/Reverse-Engineering/" style="font-size: 10.83px;">Reverse Engineering</a> <a href="/tags/SDL2/" style="font-size: 10.83px;">SDL2</a> <a href="/tags/SQLite/" style="font-size: 10px;">SQLite</a> <a href="/tags/SharpDX/" style="font-size: 11.67px;">SharpDX</a> <a href="/tags/TypeScript/" style="font-size: 10px;">TypeScript</a> <a href="/tags/Unity3D/" style="font-size: 10.83px;">Unity3D</a> <a href="/tags/Visual-Basic/" style="font-size: 10.83px;">Visual Basic</a> <a href="/tags/Visual-Studio/" style="font-size: 10.83px;">Visual Studio</a> <a href="/tags/WSL/" style="font-size: 10px;">WSL</a> <a href="/tags/WebGL/" style="font-size: 12.5px;">WebGL</a> <a href="/tags/Windows-8/" style="font-size: 10px;">Windows 8</a> <a href="/tags/kawashima/" style="font-size: 10px;">kawashima</a> <a href="/tags/live/" style="font-size: 10px;">live</a> <a href="/tags/%E4%B8%8D%E5%8F%AA%E6%98%AF%E6%8A%80%E6%9C%AF/" style="font-size: 10px;">不只是技术</a> <a href="/tags/%E4%B8%AA%E4%BA%BA/" style="font-size: 10px;">个人</a> <a href="/tags/%E4%BB%A3%E7%A0%81/" style="font-size: 11.67px;">代码</a> <a href="/tags/%E5%8A%A8%E6%BC%AB/" style="font-size: 11.67px;">动漫</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 10px;">博客</a> <a href="/tags/%E5%8D%9A%E5%AE%A2%E5%9B%AD%E8%AE%B0%E5%BD%95/" style="font-size: 13.33px;">博客园记录</a> <a href="/tags/%E5%8F%91%E5%B8%83/" style="font-size: 15px;">发布</a> <a href="/tags/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" style="font-size: 10.83px;">垃圾回收</a> <a href="/tags/%E5%B0%8F%E5%93%81/" style="font-size: 11.67px;">小品</a> <a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 10px;">并发</a> <a href="/tags/%E5%BC%B9%E5%B9%95/" style="font-size: 17.5px;">弹幕</a> <a href="/tags/%E5%BF%83%E8%B7%B3%E6%96%87%E5%AD%A6%E9%83%A8/" style="font-size: 10px;">心跳文学部</a> <a href="/tags/%E6%89%8B%E6%B8%B8/" style="font-size: 10.83px;">手游</a> <a href="/tags/%E6%97%A5%E5%B8%B8/" style="font-size: 20px;">日常</a> <a href="/tags/%E6%9C%AA%E6%9D%A5%E8%8A%B1%E5%9B%AD%E5%9B%9E%E5%BF%86/" style="font-size: 17.5px;">未来花园回忆</a> <a href="/tags/%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0/" style="font-size: 10px;">析构函数</a> <a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 10.83px;">架构</a> <a href="/tags/%E6%B8%B8%E6%88%8F/" style="font-size: 10px;">游戏</a> <a href="/tags/%E6%B8%B8%E6%88%8F%E6%9D%82%E8%B0%88/" style="font-size: 10px;">游戏杂谈</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a> <a href="/tags/%E7%BD%91%E7%AB%99%E7%BB%B4%E6%8A%A4/" style="font-size: 10px;">网站维护</a> <a href="/tags/%E8%BF%87%E5%8E%BB%E7%9A%84%E4%BA%BA%E4%BA%8B%E7%89%A9/" style="font-size: 19.17px;">过去的人事物</a> <a href="/tags/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/" style="font-size: 16.67px;">逆向工程</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://aicdg.com/" target="_blank" rel="noopener">一切胡里花哨的技术(自称)</a>
                    </li>
                
                    <li>
                        <a href="http://kkrainbow.github.io/" target="_blank" rel="noopener">KKRainbow</a>
                    </li>
                
                    <li>
                        <a href="https://kanoha.org/" target="_blank" rel="noopener">jabbany</a>
                    </li>
                
                    <li>
                        <a href="http://tsundere.moe/" target="_blank" rel="noopener">Frederick888</a>
                    </li>
                
                    <li>
                        <a href="http://blog.higan.me/" target="_blank" rel="noopener">HiganKanshi</a>
                    </li>
                
                    <li>
                        <a href="https://blog.kagami.moe/" target="_blank" rel="noopener">少年读书隙中窥月</a>
                    </li>
                
                    <li>
                        <a href="https://estertion.win/" target="_blank" rel="noopener">esterTion</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">32</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">February 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09/">September 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/11/">November 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07/">July 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/02/">February 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/01/">January 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/12/">December 2010</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/10/">October 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/08/">August 2010</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/07/">July 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/06/">June 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
    <div id="toTop" class="fas fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2020 头蟹床(Headcrabbed)<br/>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, hosted with ❤ by <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a><br/>
            Theme by <a href="http://github.com/ppoffice" target="_blank" rel="noopener">Ruipeng Zhang</a>, updated by <a href="https://github.com/hozuki/" target="_blank" rel="noopener">Hozuki</a>
        </div>
    </div>
</footer>


<!-- Highlight.js -->
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

<script src="/js/hljs-exec.js"></script>




<script src="/js/black-curtain.js"></script>


        
    
    <script>
    var disqus_config = function () {
        
            this.page.url = 'https://blog.mottomo.moe/categories/Tech/Coding/zh/2014-04-03-Using-SDL2-and-FFmpeg-to-Build-A-Simple-Player-and-Synchornization/';
        
        this.page.identifier = 'zh/2014-04-03-Using-SDL2-and-FFmpeg-to-Build-A-Simple-Player-and-Synchornization';
    };
    (function() { 
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'uiharumoe' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        s.addEventListener("error", function () {
            var div = d.getElementById("disqus_thread");
            
            var s = d.createElement("span");
            s.textContent = "Unable to load Disqus comments. Please check your DNS settings and whether it is blocked by GFW.";
            
            while (div.firstChild) {
                div.removeChild(div.firstChild);
            }
            
            div.appendChild(s);
        });
        (d.head || d.body).appendChild(s);
    })();
</script>




    
        
<script src="/libs/lightgallery/js/lightgallery.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-pager.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-zoom.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-hash.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-share.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-video.min.js"></script>

    
    
        
<script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>

    
    
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
        </script>
        
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML.js"></script>

    



<!-- Custom Scripts -->

<script src="/js/main.js"></script>


    </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>